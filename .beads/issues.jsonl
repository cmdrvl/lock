{"id":"bd-125","title":"Implement witness query/last/count subcommands and filter semantics","description":"Implement witness query/last/count subcommands with documented filters and output modes.\n\nThese commands provide read/query access to the witness ledger without mutation.","design":"- Add filtering by tool/since/until/outcome/input-hash with optional limit.\n- Implement `last` and `count` semantics with text/json modes.\n- Enforce no-match and error exit semantics per witness conventions.","acceptance_criteria":"- query/last/count all function and return deterministic data.\n- No-match and malformed ledger behavior match documented exit codes.\n- Subcommands do not mutate ledger state.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-24T23:25:31.775790Z","created_by":"zac","updated_at":"2026-02-24T23:25:31.871271Z","compaction_level":0,"original_size":0,"labels":["lock","query","witness"],"dependencies":[{"issue_id":"bd-125","depends_on_id":"bd-3w1","type":"blocks","created_at":"2026-02-24T23:25:31.871231Z","created_by":"zac"}]}
{"id":"bd-12h","title":"Scaffold lock crate and module topology from PLAN","description":"Create the initial Rust crate and module skeleton described in docs/PLAN.md.\n\nGoal: make the repo buildable with clear module boundaries so parallel work can land safely.","design":"- Add Cargo package skeleton and `src/main.rs` + `src/lib.rs` with `#![forbid(unsafe_code)]`.\n- Create module directories/files for `cli`, `input`, `lockfile`, `output`, `refusal`, and `witness`.\n- Add minimal compile-through stubs and wiring points.","acceptance_criteria":"- `cargo check` succeeds with module scaffolding in place.\n- File layout matches the planned module structure.\n- No placeholder behavior that conflicts with planned contracts.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:52.619228Z","created_by":"zac","updated_at":"2026-02-24T23:26:39.899145Z","compaction_level":0,"original_size":0,"labels":["architecture","foundation","lock"],"dependencies":[{"issue_id":"bd-12h","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-24T23:24:52.706741Z","created_by":"zac"}]}
{"id":"bd-1ab","title":"Implement run orchestration flow and exit-code semantics","description":"Implement orchestration flow and exit code semantics for the main lock command.\n\nThis is the top-level control plane that maps parse/classification/output paths to stable exits.","design":"- Sequence: parse CLI, handle describe/schema/witness, ingest, validate, build, emit, witness append.\n- Enforce exit semantics: 0 LOCK_CREATED, 1 LOCK_PARTIAL, 2 REFUSAL/CLI errors.\n- Keep refusal-first behavior when no valid lock can be created.","acceptance_criteria":"- Orchestration path matches PLAN execution flow.\n- Exit codes are stable across all listed scenarios.\n- Main command behavior is deterministic and testable.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:54.218405Z","created_by":"zac","updated_at":"2026-02-24T23:24:54.403692Z","compaction_level":0,"original_size":0,"labels":["lock","orchestrator","runtime"],"dependencies":[{"issue_id":"bd-1ab","depends_on_id":"bd-30f","type":"blocks","created_at":"2026-02-24T23:24:54.403649Z","created_by":"zac"},{"issue_id":"bd-1ab","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-24T23:24:54.356812Z","created_by":"zac"},{"issue_id":"bd-1ab","depends_on_id":"bd-3w1","type":"blocks","created_at":"2026-02-24T23:24:54.310457Z","created_by":"zac"}]}
{"id":"bd-1jj","title":"Implement witness append integration and no-witness behavior","description":"Implement witness append integration for all domain outcomes with --no-witness opt-out.\n\nWitness behavior must mirror spine conventions and never corrupt domain exit semantics.","design":"- Resolve ledger path from EPISTEMIC_WITNESS then ~/.epistemic/witness.jsonl.\n- Append witness records for LOCK_CREATED, LOCK_PARTIAL, and REFUSAL outcomes.\n- Preserve domain exit code when witness append fails; emit warning only.","acceptance_criteria":"- Default run appends one witness record per invocation.\n- --no-witness suppresses append.\n- Append failures do not change exit 0/1/2 semantics.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-24T23:25:31.621147Z","created_by":"zac","updated_at":"2026-02-24T23:30:40.555645Z","compaction_level":0,"original_size":0,"labels":["ledger","lock","wave-3","witness"],"dependencies":[{"issue_id":"bd-1jj","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-24T23:25:31.715258Z","created_by":"zac"}]}
{"id":"bd-1ub","title":"Implement describe/schema output paths with embedded artifacts","description":"Implement --describe and --schema outputs with embedded artifacts.\n\nThese are required for agent/automation introspection and contract verification.","design":"- Add/maintain operator.json and lock.v0 schema artifacts in repo.\n- Wire CLI to emit artifacts verbatim and exit 0 before input validation.\n- Keep artifact versioning synchronized with lock package version and output schema.","acceptance_criteria":"- `lock --describe` emits operator.json on stdout with exit 0.\n- `lock --schema` emits lock schema on stdout with exit 0.\n- Emitted artifacts validate as JSON and remain deterministic.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:25:31.934760Z","created_by":"zac","updated_at":"2026-02-24T23:30:40.514341Z","compaction_level":0,"original_size":0,"labels":["lock","operator","schema","wave-2"],"dependencies":[{"issue_id":"bd-1ub","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-24T23:25:32.028724Z","created_by":"zac"},{"issue_id":"bd-1ub","depends_on_id":"bd-3w1","type":"blocks","created_at":"2026-02-24T23:30:14.406737Z","created_by":"zac"}]}
{"id":"bd-2jb","title":"Release guardrails: version bump flow and artifact publish verification","description":"Harden lock release flow so version bumps and artifact publishing are deterministic and verifiable.","design":"- Define/implement release workflow expectations (version source of truth, lockfile sync, --locked behavior).\n- Add publish verification steps (run status + release existence checks).\n- Document an explicit release checklist for maintainers and agents.","acceptance_criteria":"- Release workflow fails clearly when version/lockfile state is invalid.\n- Release publish verification steps are documented and reproducible.\n- Maintainer checklist covers bump, push, and release validation.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T23:30:27.070573Z","created_by":"zac","updated_at":"2026-02-24T23:30:40.597305Z","compaction_level":0,"original_size":0,"labels":["automation","lock","release","wave-4"],"dependencies":[{"issue_id":"bd-2jb","depends_on_id":"bd-3ro","type":"blocks","created_at":"2026-02-24T23:30:27.169559Z","created_by":"zac"}]}
{"id":"bd-2kh","title":"Implement canonical JSON serializer with sorted keys at all levels","description":"Implement canonical JSON serialization with sorted keys at every object level.\n\nThis is the basis for deterministic self-hash and cross-platform reproducibility.","design":"- Define a canonical serializer strategy aligned with PLAN constraints.\n- Ensure top-level keys are sorted (not struct declaration order).\n- Emit compact JSON without trailing newline artifacts.","acceptance_criteria":"- Same semantic input yields byte-identical canonical output with fixed timestamp.\n- Nested and top-level keys are deterministically ordered.\n- Canonical serializer is covered by deterministic tests.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.626139Z","created_by":"zac","updated_at":"2026-02-24T23:30:40.471867Z","compaction_level":0,"original_size":0,"labels":["canonicalization","determinism","lock","wave-1"],"dependencies":[{"issue_id":"bd-2kh","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-24T23:24:53.716597Z","created_by":"zac"}]}
{"id":"bd-2ku","title":"Integration tests: outcomes, refusal envelopes, deterministic ordering","description":"Add integration tests for main command outcomes and output contracts.\n\nThis is the operator-facing confidence layer for lock.v0 behavior.","design":"- Cover LOCK_CREATED, LOCK_PARTIAL, and REFUSAL scenarios end-to-end.\n- Assert output JSON shape, exit codes, and deterministic member ordering.\n- Include unknown-version and empty-input refusal paths.","acceptance_criteria":"- Integration matrix covers all domain outcomes.\n- Golden/snapshot assertions guard key output fields and refusal codes.\n- Exit-code assertions are explicit and stable.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-24T23:25:32.594311Z","created_by":"zac","updated_at":"2026-02-24T23:25:32.689097Z","compaction_level":0,"original_size":0,"labels":["integration","lock","tests"],"dependencies":[{"issue_id":"bd-2ku","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-24T23:25:32.689061Z","created_by":"zac"}]}
{"id":"bd-2oz","title":"Implement record version gate and required-field validation","description":"Implement version compatibility gate and required-field validation for non-skipped records.\n\nlock must only accept known upstream record versions and must refuse incomplete non-skipped records.","design":"- Accept only vacuum.v0/hash.v0/fingerprint.v0 as input record versions.\n- Refuse unknown or missing versions with E_BAD_INPUT detail.\n- Validate required fields for non-skipped records and accumulate missing-hash samples for E_MISSING_HASH.","acceptance_criteria":"- Unknown version records refuse deterministically with line/detail context.\n- Missing bytes_hash on non-skipped records triggers E_MISSING_HASH.\n- Skipped records do not trigger missing-hash refusal.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.196489Z","created_by":"zac","updated_at":"2026-02-24T23:24:53.285511Z","compaction_level":0,"original_size":0,"labels":["input","lock","validation"],"dependencies":[{"issue_id":"bd-2oz","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-24T23:24:53.285470Z","created_by":"zac"}]}
{"id":"bd-30f","title":"Implement lockfile output renderer and outcome mapping","description":"Implement final lockfile renderer and domain outcome mapping.\n\nThe renderer must emit correct lock.v0 output for LOCK_CREATED and LOCK_PARTIAL outcomes.","design":"- Assemble final top-level lockfile object with required counts and fields.\n- Emit stdout JSON artifact for exits 0/1 and refusal envelope for exit 2.\n- Keep stream behavior strict: no extra banners/noise.","acceptance_criteria":"- LOCK_CREATED output has skipped_count=0 and exit 0.\n- LOCK_PARTIAL output has skipped_count>0 and exit 1.\n- REFUSAL output shape is stable and machine-parseable.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.924186Z","created_by":"zac","updated_at":"2026-02-24T23:24:54.157097Z","compaction_level":0,"original_size":0,"labels":["contract","lock","output"],"dependencies":[{"issue_id":"bd-30f","depends_on_id":"bd-3c0","type":"blocks","created_at":"2026-02-24T23:24:54.157057Z","created_by":"zac"},{"issue_id":"bd-30f","depends_on_id":"bd-3dl","type":"blocks","created_at":"2026-02-24T23:24:54.018260Z","created_by":"zac"},{"issue_id":"bd-30f","depends_on_id":"bd-3un","type":"blocks","created_at":"2026-02-24T23:24:54.065359Z","created_by":"zac"},{"issue_id":"bd-30f","depends_on_id":"bd-8em","type":"blocks","created_at":"2026-02-24T23:24:54.111667Z","created_by":"zac"}]}
{"id":"bd-367","title":"Unit tests: canonical serialization and self-hash determinism","description":"Add deterministic unit tests for canonical serialization and self-hash verification.\n\nThese tests are the guardrail against silent lock integrity regressions.","design":"- Test canonical key ordering and stable byte output for fixed inputs.\n- Test lock_hash compute/verify round-trip and tamper detection.\n- Include cross-field perturbation cases to ensure hash sensitivity.","acceptance_criteria":"- Determinism tests pass across repeated runs.\n- Verification helper catches modified payloads.\n- Serialization tests assert top-level and nested key ordering assumptions.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-24T23:25:32.385883Z","created_by":"zac","updated_at":"2026-02-24T23:25:32.535643Z","compaction_level":0,"original_size":0,"labels":["hashing","lock","tests","unit"],"dependencies":[{"issue_id":"bd-367","depends_on_id":"bd-2kh","type":"blocks","created_at":"2026-02-24T23:25:32.489354Z","created_by":"zac"},{"issue_id":"bd-367","depends_on_id":"bd-8em","type":"blocks","created_at":"2026-02-24T23:25:32.535603Z","created_by":"zac"}]}
{"id":"bd-36t","title":"LOCK v0 epic: deterministic dataset lockfile implementation","description":"Implement lock.v0 end-to-end from docs/PLAN.md as an artifact-grade, deterministic, self-hashed lockfile tool.\n\nThis epic tracks delivery of CLI, input handling, refusal semantics, canonical serialization, self-hash, witness parity, and test coverage.","design":"Execution strategy:\n- Build lock in modular slices: CLI, input pipeline, lockfile assembly, canonical/self-hash, witness, output.\n- Keep behavior deterministic and refusal-first when ambiguity exists.\n- Validate every contract against the plan, not inferred behavior.","acceptance_criteria":"- All child beads in this epic are closed.\n- The lock binary implements LOCK_CREATED/LOCK_PARTIAL/REFUSAL semantics exactly.\n- Evidence-grade tests pass and CI gate is green.","notes":"Use this epic as the swarm umbrella; all implementation beads should reference this item.","status":"deferred","priority":0,"issue_type":"epic","created_at":"2026-02-24T23:23:50.040845Z","created_by":"zac","updated_at":"2026-02-24T23:30:40.638135Z","defer_until":"2027-02-24T23:27:12.734793Z","compaction_level":0,"original_size":0,"labels":["epic","lock","spine","umbrella","v0"]}
{"id":"bd-3c0","title":"Implement refusal model and REFUSAL envelope contracts","description":"Implement refusal data model and envelope rendering for E_EMPTY, E_BAD_INPUT, and E_MISSING_HASH.\n\nRefusals must be machine-actionable and include concrete next steps.","design":"- Define refusal code enum and detail payloads for each refusal scenario.\n- Implement refusal JSON envelope writer with `version`, `outcome`, and `refusal` object.\n- Provide deterministic next_command generation for recovery paths.","acceptance_criteria":"- Envelope shape matches docs/PLAN.md examples and detail schemas.\n- Unknown/missing fields are not emitted ad hoc.\n- Refusal renderer is reusable across parse/input/orchestration failures.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:52.908650Z","created_by":"zac","updated_at":"2026-02-24T23:24:52.997949Z","compaction_level":0,"original_size":0,"labels":["api","lock","refusal"],"dependencies":[{"issue_id":"bd-3c0","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-24T23:24:52.997904Z","created_by":"zac"}]}
{"id":"bd-3c4","title":"Witness tests: append behavior, filters, and subcommand exits","description":"## Context\nAdd witness behavior tests for append/query/count/last and no-witness behavior.\n\nThis ensures parity with spine witness semantics and prevents regressions.\n\n## Implementation Plan\n- Test append on LOCK_CREATED/LOCK_PARTIAL/REFUSAL outcomes.\n- Test --no-witness suppression and append failure non-interference.\n- Test query filters and no-match exit semantics.\n\n## Acceptance Criteria\n- Witness tests validate both happy-path and degraded ledger scenarios.\n- Domain exits remain stable under witness write/read failures.\n- Query/last/count commands produce expected records and counts.\n\n## Definition of Done\nDefinition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","design":"- Test append on LOCK_CREATED/LOCK_PARTIAL/REFUSAL outcomes.\n- Test --no-witness suppression and append failure non-interference.\n- Test query filters and no-match exit semantics.","acceptance_criteria":"- Witness tests validate both happy-path and degraded ledger scenarios.\n- Domain exits remain stable under witness write/read failures.\n- Query/last/count commands produce expected records and counts.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T23:25:32.751155Z","created_by":"zac","updated_at":"2026-02-24T23:26:13.448570Z","compaction_level":0,"original_size":0,"labels":["lock","tests","witness"],"dependencies":[{"issue_id":"bd-3c4","depends_on_id":"bd-125","type":"blocks","created_at":"2026-02-24T23:25:32.898654Z","created_by":"zac"},{"issue_id":"bd-3c4","depends_on_id":"bd-1jj","type":"blocks","created_at":"2026-02-24T23:25:32.851630Z","created_by":"zac"}]}
{"id":"bd-3dl","title":"Implement member/skipped classification and deterministic ordering","description":"Implement member/skipped classification, path normalization, and deterministic sorting.\n\nThis defines what the lock actually covers and how stable output ordering is guaranteed.","design":"- Route `_skipped: true` records into skipped entries with warnings payload.\n- Normalize member path from `relative_path` with fallback rules from the plan.\n- Sort members and skipped entries by lexicographic byte-order path.","acceptance_criteria":"- skipped_count/member_count reflect actual arrays exactly.\n- LOCK_PARTIAL outcome occurs when skipped array is non-empty.\n- Ordering is deterministic across repeated runs with fixed inputs.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-24T23:24:53.326155Z","created_by":"zac","updated_at":"2026-02-24T23:24:53.414733Z","compaction_level":0,"original_size":0,"labels":["data-model","lock","lockfile"],"dependencies":[{"issue_id":"bd-3dl","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-24T23:24:53.414694Z","created_by":"zac"}]}
{"id":"bd-3hx","title":"Docs hardening: align README/AGENTS/operator/schema with implementation","description":"Finalize README/AGENTS/operator/schema docs so shipped behavior and documentation are in lockstep.\n\nDocs must remain operational for both humans and agent swarms.","design":"- Update examples, flag docs, and outcome/refusal tables to match implementation.\n- Keep AGENTS workflow guidance aligned with actual commands and CI gates.\n- Ensure operator/schema examples and version references are consistent.","acceptance_criteria":"- README examples run against current CLI contract.\n- AGENTS instructions do not contradict implemented behavior.\n- No stale references to deferred or non-existent functionality.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T23:25:32.959433Z","created_by":"zac","updated_at":"2026-02-24T23:25:33.105515Z","compaction_level":0,"original_size":0,"labels":["docs","lock","quality"],"dependencies":[{"issue_id":"bd-3hx","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-24T23:25:33.055246Z","created_by":"zac"},{"issue_id":"bd-3hx","depends_on_id":"bd-1ub","type":"blocks","created_at":"2026-02-24T23:25:33.105476Z","created_by":"zac"}]}
{"id":"bd-3nw","title":"Implement JSONL input reader with line-aware parse errors","description":"Build JSONL input ingestion from stdin or optional file arg with line-aware diagnostics.\n\nThis is the ingestion backbone for lock member/skipped classification.","design":"- Implement source selection: file path when provided, otherwise stdin.\n- Parse line-by-line JSONL preserving line number context.\n- Map malformed JSON to E_BAD_INPUT with detail including line and parser error.","acceptance_criteria":"- Empty stream is detectable and distinguishable from parse failures.\n- Parse failure details contain actionable location data.\n- Reader supports large inputs without loading all text as one string.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.055625Z","created_by":"zac","updated_at":"2026-02-24T23:24:53.141704Z","compaction_level":0,"original_size":0,"labels":["input","lock","parsing"],"dependencies":[{"issue_id":"bd-3nw","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-24T23:24:53.141656Z","created_by":"zac"}]}
{"id":"bd-3ro","title":"CI guardrails: fmt clippy test and locked-build PR checks","description":"Harden CI checks for lock so PRs fail fast on quality regressions and lockfile drift.","design":"- Add CI workflow gates for fmt/clippy/test.\n- Add locked build verification in CI to catch Cargo.toml/Cargo.lock drift early.\n- Keep failures explicit and actionable in logs.","acceptance_criteria":"- CI fails on formatting/lint/test regressions.\n- Locked-build mismatch is surfaced on PR checks.\n- CI docs or workflow comments explain the gate intent.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T23:25:33.167916Z","created_by":"zac","updated_at":"2026-02-24T23:30:27.024788Z","compaction_level":0,"original_size":0,"labels":["ci","lock","release"],"dependencies":[{"issue_id":"bd-3ro","depends_on_id":"bd-2ku","type":"blocks","created_at":"2026-02-24T23:25:33.365366Z","created_by":"zac"},{"issue_id":"bd-3ro","depends_on_id":"bd-367","type":"blocks","created_at":"2026-02-24T23:25:33.315387Z","created_by":"zac"},{"issue_id":"bd-3ro","depends_on_id":"bd-v08","type":"blocks","created_at":"2026-02-24T23:25:33.267797Z","created_by":"zac"}]}
{"id":"bd-3un","title":"Implement tool_versions accumulation and metadata hydration","description":"Implement metadata hydration and tool_versions accumulation rules.\n\nlock must preserve provenance across all records, including skipped inputs.","design":"- Merge `tool_versions` from every input record (members + skipped).\n- Keep first-seen version on tool collisions and append lock's own version.\n- Populate top-level dataset_id/as_of/note/profiles fields exactly per plan.","acceptance_criteria":"- tool_versions contains upstream tools plus lock.\n- profiles defaults to [] in v0.\n- Optional metadata fields are explicit null when omitted.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-24T23:24:53.475842Z","created_by":"zac","updated_at":"2026-02-24T23:24:53.567342Z","compaction_level":0,"original_size":0,"labels":["lock","metadata","provenance"],"dependencies":[{"issue_id":"bd-3un","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-24T23:24:53.567304Z","created_by":"zac"}]}
{"id":"bd-3w1","title":"Implement CLI contract and argument parsing (main + witness subcommands)","description":"Implement CLI parsing for compare mode and witness subcommands.\n\nThis includes positional input selection and all declared flags.","design":"- Define clap structs for `lock [input]` plus flags: dataset_id, as_of, note, no_witness, describe, schema, version.\n- Add witness subcommands: query, last, count with filter flags and --json switches.\n- Ensure `--describe`/`--schema` short-circuit before input validation.","acceptance_criteria":"- CLI accepts all plan-declared options/subcommands.\n- Parse-level errors return exit 2 semantics.\n- Help/usage text is coherent and non-ambiguous.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:52.764086Z","created_by":"zac","updated_at":"2026-02-24T23:30:14.361161Z","compaction_level":0,"original_size":0,"labels":["cli","foundation","lock"],"dependencies":[{"issue_id":"bd-3w1","depends_on_id":"bd-12h","type":"blocks","created_at":"2026-02-24T23:30:14.361121Z","created_by":"zac"},{"issue_id":"bd-3w1","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-24T23:24:52.854423Z","created_by":"zac"}]}
{"id":"bd-7ot","title":"E2E spine compatibility fixtures for vacuum|hash|fingerprint -> lock","description":"Build end-to-end compatibility fixtures for the spine path: vacuum | hash | fingerprint | lock.\n\nThese fixtures verify lock integrates cleanly with upstream record formats.","design":"- Add representative fixture streams for hash-only and fingerprinted records.\n- Assert lock output members/skipped/tool_versions against fixtures.\n- Include at least one degraded `_skipped` upstream case.","acceptance_criteria":"- E2E fixture tests demonstrate spine compatibility and partial-lock behavior.\n- Fixture data is deterministic and documented.\n- Regression test fails if upstream compatibility assumptions break.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T23:25:33.427767Z","created_by":"zac","updated_at":"2026-02-24T23:25:33.578052Z","compaction_level":0,"original_size":0,"labels":["e2e","lock","spine","tests"],"dependencies":[{"issue_id":"bd-7ot","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-24T23:25:33.529275Z","created_by":"zac"},{"issue_id":"bd-7ot","depends_on_id":"bd-1jj","type":"blocks","created_at":"2026-02-24T23:25:33.578016Z","created_by":"zac"}]}
{"id":"bd-8em","title":"Implement self-hash (lock_hash) compute and verifier helper","description":"Implement lock self-hash computation and verification helper.\n\nlock_hash is a core integrity guarantee and must follow PLAN byte-for-byte semantics.","design":"- Build lock object with lock_hash=\"\" for pre-hash canonicalization.\n- SHA256 canonical bytes and inject `sha256:<hex>` into final output.\n- Add verification helper path for tests and downstream tooling.","acceptance_criteria":"- Recomputed hash matches emitted lock_hash for valid artifacts.\n- Any payload mutation causes verification failure.\n- Hash helper is deterministic and isolated from wall-clock variance.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.774334Z","created_by":"zac","updated_at":"2026-02-24T23:24:53.867073Z","compaction_level":0,"original_size":0,"labels":["hashing","integrity","lock"],"dependencies":[{"issue_id":"bd-8em","depends_on_id":"bd-2kh","type":"blocks","created_at":"2026-02-24T23:24:53.867033Z","created_by":"zac"}]}
{"id":"bd-v08","title":"Unit tests: parsing, version-gate, missing-hash, skipped handling","description":"Add unit coverage for parsing and validation primitives.\n\nThese tests must lock in refusal behavior before orchestration-level tests.","design":"- Unit-test parse failures, version gate failures, and missing-hash refusal conditions.\n- Test skipped-record routing and partial classification edge-cases.\n- Add fixtures for unknown versions and malformed lines.","acceptance_criteria":"- Unit tests fail on regressions for E_BAD_INPUT and E_MISSING_HASH handling.\n- Skipped/non-skipped behavior is explicitly covered.\n- Test names clearly map to plan clauses.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-24T23:25:32.089076Z","created_by":"zac","updated_at":"2026-02-24T23:25:32.323381Z","compaction_level":0,"original_size":0,"labels":["input","lock","tests","unit"],"dependencies":[{"issue_id":"bd-v08","depends_on_id":"bd-2oz","type":"blocks","created_at":"2026-02-24T23:25:32.230288Z","created_by":"zac"},{"issue_id":"bd-v08","depends_on_id":"bd-3c0","type":"blocks","created_at":"2026-02-24T23:25:32.323340Z","created_by":"zac"},{"issue_id":"bd-v08","depends_on_id":"bd-3dl","type":"blocks","created_at":"2026-02-24T23:25:32.275817Z","created_by":"zac"},{"issue_id":"bd-v08","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-24T23:25:32.182080Z","created_by":"zac"}]}
