{"id":"bd-125","title":"Implement witness query/last/count subcommands and filter semantics","description":"Implement witness query/last/count subcommands with documented filters and output modes.\n\nThese commands provide read/query access to the witness ledger without mutation.","design":"- Add filtering by tool/since/until/outcome/input-hash with optional limit.\n- Implement `last` and `count` semantics with text/json modes.\n- Enforce no-match and error exit semantics per witness conventions.","acceptance_criteria":"- query/last/count all function and return deterministic data.\n- No-match and malformed ledger behavior match documented exit codes.\n- Subcommands do not mutate ledger state.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-24T23:25:31.775790Z","created_by":"zac","updated_at":"2026-02-24T23:56:05.739297Z","closed_at":"2026-02-24T23:56:05.739193Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["lock","query","witness"],"dependencies":[{"issue_id":"bd-125","depends_on_id":"bd-3w1","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-12h","title":"Scaffold lock crate and module topology from PLAN","description":"Create the initial Rust crate and module skeleton described in docs/PLAN.md.\n\nGoal: make the repo buildable with clear module boundaries so parallel work can land safely.","design":"- Add Cargo package skeleton and `src/main.rs` + `src/lib.rs` with `#![forbid(unsafe_code)]`.\n- Create module directories/files for `cli`, `input`, `lockfile`, `output`, `refusal`, and `witness`.\n- Add minimal compile-through stubs and wiring points.","acceptance_criteria":"- `cargo check` succeeds with module scaffolding in place.\n- File layout matches the planned module structure.\n- No placeholder behavior that conflicts with planned contracts.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","assignee":"FrostyHollow","created_at":"2026-02-24T23:24:52.619228Z","created_by":"zac","updated_at":"2026-02-24T23:42:39.285024Z","closed_at":"2026-02-24T23:42:39.281489Z","close_reason":"Scaffold module topology complete","source_repo":".","compaction_level":0,"original_size":0,"labels":["architecture","foundation","lock"],"dependencies":[{"issue_id":"bd-12h","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bd-12h","author":"FrostyHollow","text":"Implemented scaffold crate/module topology: added Cargo package (, generated ),  + , and stub modules , ,  (+ ), , , . Validation passed: , , , \nrunning 10 tests\ntest refusal::tests::empty_envelope_shape ... ok\ntest refusal::tests::bad_input_version_envelope_shape ... ok\ntest refusal::tests::bad_input_parse_envelope_shape ... ok\ntest refusal::tests::missing_hash_envelope_shape ... ok\ntest refusal::tests::refusal_code_serialize ... ok\ntest refusal::tests::empty_detail_is_empty_object ... ok\ntest refusal::tests::envelope_json_no_trailing_newline ... ok\ntest refusal::tests::null_next_command_serializes_as_null ... ok\ntest refusal::tests::envelope_json_has_sorted_keys ... ok\ntest refusal::tests::envelope_json_round_trip ... ok\n\ntest result: ok. 10 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s. Released file reservations to unblock bd-3nw/bd-2kh/bd-3c0.","created_at":"2026-02-24T23:41:48Z"},{"id":2,"issue_id":"bd-12h","author":"FrostyHollow","text":"Scaffold delivered: Cargo package, main/lib entrypoints, and module topology for cli/input/lockfile/output/refusal/witness. Validation passed: cargo check --all-targets; cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test. Reservations released to unblock bd-3nw, bd-3c0, and bd-2kh.","created_at":"2026-02-24T23:42:39Z"}]}
{"id":"bd-1ab","title":"Implement run orchestration flow and exit-code semantics","description":"Implement core run orchestration and exit-code semantics for the main lock command.\n\nThis bead coordinates parse/validate/build/emit paths and refusal wiring; witness append behavior is handled separately.","design":"- Sequence: parse CLI, handle describe/schema/witness subcommand dispatch, ingest, validate, build, emit.\n- Enforce exit semantics: 0 LOCK_CREATED, 1 LOCK_PARTIAL, 2 REFUSAL/CLI errors.\n- Integrate refusal model/envelope decisions without duplicating witness append logic.","acceptance_criteria":"- Orchestration path matches PLAN execution flow (excluding witness append specifics).\n- Exit codes are stable across LOCK_CREATED/LOCK_PARTIAL/REFUSAL and parse errors.\n- Refusal integration is deterministic and testable.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","assignee":"MagentaLake","created_at":"2026-02-24T23:24:54.218405Z","created_by":"zac","updated_at":"2026-02-24T23:56:27.660158Z","closed_at":"2026-02-24T23:56:27.658733Z","close_reason":"Implemented orchestration flow with stable 0/1/2 exits and full validation pass","source_repo":".","compaction_level":0,"original_size":0,"labels":["lock","orchestrator","runtime"],"dependencies":[{"issue_id":"bd-1ab","depends_on_id":"bd-30f","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1ab","depends_on_id":"bd-3c0","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1ab","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1ab","depends_on_id":"bd-3w1","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":3,"issue_id":"bd-1ab","author":"MagentaLake","text":"Start update: implementing main run orchestration + domain exit semantics in src/lib.rs with deterministic refusal/output dispatch paths.","created_at":"2026-02-24T23:50:48Z"},{"id":4,"issue_id":"bd-1ab","author":"MagentaLake","text":"Progress update: orchestration flow implemented in src/lib.rs and wired from cli::dispatch_lock. Blocked on full validation due concurrent witness-module regressions outside bd-1ab scope: unsafe env var calls conflict with #![forbid(unsafe_code)] and clippy -D warnings failures in src/witness/mod.rs. Commands attempted: cargo fmt --check (pass), cargo check --all-targets (fails in witness tests), cargo clippy --all-targets -- -D warnings (fails in witness), cargo test (fails in witness).","created_at":"2026-02-24T23:53:38Z"},{"id":5,"issue_id":"bd-1ab","author":"MagentaLake","text":"Continuation update: re-read AGENTS/README and resumed bd-1ab. Proceeding with file-scoped edits only and re-running validation to close orchestration bead or switch immediately if witness lane still blocks full gate.","created_at":"2026-02-24T23:55:44Z"},{"id":6,"issue_id":"bd-1ab","author":"MagentaLake","text":"Finish update: completed run orchestration flow and exit mapping in src/lib.rs + wired cli::dispatch_lock to crate::run_lock. Flow now handles read -> validate -> classify -> metadata hydrate -> self-hash -> render, with refusal envelopes for parse/version/missing-hash/classification failures. Added orchestration unit tests for LOCK_CREATED/LOCK_PARTIAL/REFUSAL paths and missing-input-file exit. Validation passed: cargo fmt --check; cargo check --all-targets; cargo clippy --all-targets -- -D warnings; cargo test (85 passed).","created_at":"2026-02-24T23:56:27Z"}]}
{"id":"bd-1cj","title":"Release parity: artifact matrix + checksums + signatures + SBOM + provenance","description":"Implement rvl-grade release artifact infrastructure for lock.\n\nDesign:\n- Build and package release binaries for linux/macos/windows targets in workflow matrix.\n- Publish versioned archives plus SHA256SUMS.\n- Sign release checksums and emit verifiable signature/certificate artifacts.\n- Generate SBOM and provenance artifacts and attach all outputs to GitHub release.\n\nAcceptance criteria:\n- release workflow emits multi-target archives and uploads them to GitHub Releases.\n- SHA256SUMS + signature/certificate are produced and published.\n- SBOM + provenance artifacts are generated and published.\n- Workflow is idempotent on reruns (safe when tag/release already exists).","status":"closed","priority":1,"issue_type":"feature","assignee":"SunnyLynx","created_at":"2026-02-25T02:47:06.211881Z","created_by":"zac","updated_at":"2026-02-25T02:56:27.700862Z","closed_at":"2026-02-25T02:51:01.110717Z","close_reason":"Release workflow enhanced with all acceptance criteria:\n1. Multi-target build matrix (5 targets: x86_64-linux, aarch64-linux, x86_64-macos, aarch64-macos, x86_64-windows)\n2. SHA256SUMS + cosign keyless signature/certificate\n3. CycloneDX SBOM + GitHub build provenance attestation\n4. Idempotent on reruns (tag/release reuse, --clobber uploads)\nQuality gate: fmt clean, clippy clean, 198 tests pass. YAML validated.","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci","lock","release","supply-chain"],"dependencies":[{"issue_id":"bd-1cj","depends_on_id":"bd-3c5","type":"parent-child","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":7,"issue_id":"bd-1cj","author":"SunnyLynx","text":"Claimed by SunnyLynx; starting release parity implementation now. Initial focus: workflow matrix, checksums/signatures, SBOM/provenance wiring.","created_at":"2026-02-25T02:49:31Z"},{"id":8,"issue_id":"bd-1cj","author":"Zac","text":"Release workflow updated with rvl-grade parity:\n- 5-target build matrix (linux x86_64/aarch64, macOS Intel/ARM, Windows)\n- Binary stripping for all platforms (native + cross)\n- SHA256SUMS + cosign keyless signature/certificate\n- CycloneDX SBOM via cargo-cyclonedx\n- SLSA provenance (in-toto statement + GitHub attestation)\n- Idempotent tag/release/upload (--clobber on rerun)\n- Fast tool installs via taiki-e/install-action\n- Fixed cargo cyclonedx flag (--override-filename, not --output-file)\n- Homebrew tap job also present (bd-dj6 scope, already implemented)\nGates: fmt clean, clippy clean, 204 tests pass. YAML validated.","created_at":"2026-02-25T02:55:27Z"},{"id":9,"issue_id":"bd-1cj","author":"SunnyLynx","text":"Progress update: refined release workflow artifact assembly for bd-1cj. Key updates in .github/workflows/release.yml: keyless cosign signing with strict shell flags, SPDX SBOM generation via anchore/sbom-action, provenance attestation from SHA256SUMS with bundle copied into artifacts before gh release upload (so provenance is published with release assets), and idempotent upload retained via --clobber. Updated README release guardrail bullets for matrix/checksum/signature/SBOM/provenance behavior.\n\nValidation run locally:\n- cargo check --all-targets (pass)\n- cargo fmt --check (pass)\n- cargo clippy --all-targets -- -D warnings (pass)\n- cargo test (pass; all suites green)","created_at":"2026-02-25T02:55:42Z"},{"id":10,"issue_id":"bd-1cj","author":"SunnyLynx","text":"Closure evidence:\n- : release pipeline now builds matrix archives (Linux/macOS/Windows targets), generates , signs checksums with keyless cosign ( + ), generates SBOM (), generates provenance via  using , copies bundle to , and uploads all artifacts to GitHub Release with  for rerun safety.\n- : release guardrails updated to document matrix assets + checksum/signature + SBOM/provenance behavior.\n\nValidation commands (local):\n-  ✅\n-  ✅\n-  ✅\n- \nrunning 102 tests\ntest cli::tests::dispatch_describe_returns_zero ... ok\ntest cli::tests::dispatch_schema_returns_zero ... ok\ntest cli::tests::operator_json_is_valid_json ... ok\ntest cli::tests::lock_schema_is_valid_json ... ok\ntest cli::tests::parse_no_args ... ok\ntest cli::tests::parse_describe_flag ... ok\ntest cli::tests::parse_schema_flag ... ok\ntest cli::tests::parse_no_witness_flag ... ok\ntest cli::tests::parse_input_file ... ok\ntest cli::tests::parse_all_metadata_flags ... ok\ntest cli::tests::unknown_word_parsed_as_input_file ... ok\ntest cli::tests::parse_witness_last ... ok\ntest cli::tests::reject_unknown_flag ... ok\ntest cli::tests::parse_witness_query_with_until ... ok\ntest cli::tests::parse_witness_count ... ok\ntest cli::tests::parse_witness_query ... ok\ntest input::tests::missing_input_file_returns_io_error ... ok\ntest input::tests::empty_line_is_parse_error ... ok\ntest input::tests::parse_error_contains_failing_line_number ... ok\ntest input::tests::parses_multiple_jsonl_records_with_line_numbers ... ok\ntest input::tests::returns_empty_for_empty_stream ... ok\ntest input::tests::validate_records_ignores_missing_hash_for_skipped_record ... ok\ntest input::tests::validate_records_accepts_known_versions_and_hashes ... ok\ntest input::tests::validate_records_rejects_missing_version ... ok\ntest input::tests::validate_records_rejects_unknown_version ... ok\ntest input::tests::validate_records_reports_missing_hash_for_non_skipped_records ... ok\ntest lockfile::self_hash::tests::canonical_json_has_no_trailing_newline ... ok\ntest lockfile::self_hash::tests::canonical_json_sorts_keys_at_every_level ... ok\ntest lockfile::self_hash::tests::canonical_json_is_deterministic_for_equivalent_values ... ok\ntest lockfile::self_hash::tests::compute_produces_sha256_prefixed_hex ... ok\ntest lockfile::self_hash::tests::lockfile_canonical_json_orders_top_level_and_nested_keys ... ok\ntest lockfile::self_hash::tests::pre_hash_lockfile_uses_empty_lock_hash ... ok\ntest lockfile::self_hash::tests::verify_detects_hash_tampering ... ok\ntest lockfile::tests::classify_records_computes_counts_and_partial_outcome ... ok\ntest lockfile::tests::classify_records_is_deterministic_for_same_input ... ok\ntest lockfile::self_hash::tests::compute_is_deterministic ... ok\ntest lockfile::tests::classify_records_requires_bytes_hash_for_non_skipped_records ... ok\ntest lockfile::self_hash::tests::different_data_produces_different_hash ... ok\ntest lockfile::tests::classify_records_sorts_paths_and_normalizes_separators ... ok\ntest lockfile::tests::classify_records_uses_path_when_relative_path_is_missing ... ok\ntest lockfile::self_hash::tests::verify_detects_tampering ... ok\ntest lockfile::tests::hydrate_metadata_sets_nullable_fields_and_defaults_profiles ... ok\ntest lockfile::tests::hydrate_metadata_uses_nullables_when_flags_omitted ... ok\ntest lockfile::self_hash::tests::verify_round_trip ... ok\ntest lockfile::self_hash::tests::verify_from_json_detects_tampering ... ok\ntest lockfile::tests::merge_tool_versions_includes_skipped_records_and_preserves_first_seen ... ok\ntest output::tests::outcome_is_lock_created_when_no_skipped_records ... ok\ntest lockfile::self_hash::tests::verify_from_json_detects_nested_member_tampering ... ok\ntest lockfile::self_hash::tests::verify_from_json_round_trip ... ok\ntest output::tests::outcome_is_lock_partial_when_skipped_records_exist ... ok\ntest refusal::tests::bad_input_parse_envelope_shape ... ok\ntest refusal::tests::bad_input_version_envelope_shape ... ok\ntest output::tests::render_lockfile_is_compact_and_json ... ok\ntest refusal::tests::detail_keys_sorted_in_missing_hash ... ok\ntest refusal::tests::detail_keys_sorted_in_parse_error ... ok\ntest refusal::tests::empty_envelope_shape ... ok\ntest refusal::tests::deterministic_output ... ok\ntest refusal::tests::empty_detail_is_empty_object ... ok\ntest refusal::tests::envelope_compact_no_extra_whitespace ... ok\ntest refusal::tests::envelope_json_has_sorted_keys ... ok\ntest refusal::tests::envelope_json_no_trailing_newline ... ok\ntest refusal::tests::missing_hash_plural_message ... ok\ntest refusal::tests::envelope_json_round_trip ... ok\ntest refusal::tests::missing_hash_envelope_shape ... ok\ntest refusal::tests::missing_hash_singular_message ... ok\ntest refusal::tests::refusal_code_serialize ... ok\ntest refusal::tests::missing_hash_truncates_sample_paths ... ok\ntest refusal::tests::null_next_command_serializes_as_null ... ok\ntest tests::orchestration_maps_empty_input_to_refusal ... ok\ntest tests::orchestration_maps_missing_hash_to_refusal ... ok\ntest tests::orchestration_maps_complete_records_to_lock_created ... ok\ntest tests::orchestration_maps_skipped_records_to_lock_partial ... ok\ntest witness::tests::append_to_invalid_path_returns_error ... ok\ntest witness::tests::empty_filters_match_all ... ok\ntest witness::tests::filter_by_outcome ... ok\ntest witness::tests::filter_by_since ... ok\ntest witness::tests::filter_by_since_uses_instant_comparison_for_mixed_offsets ... ok\ntest witness::tests::filter_by_since_uses_instant_not_lexicographic_order ... ok\ntest witness::tests::filter_by_tool ... ok\ntest witness::tests::filter_by_until ... ok\ntest witness::tests::filter_combined ... ok\ntest witness::tests::filter_with_invalid_record_timestamp_matches_none_when_time_filter_used ... ok\ntest witness::tests::filter_with_invalid_since_timestamp_matches_none ... ok\ntest witness::tests::append_creates_ledger_and_writes_record ... ok\ntest witness::tests::append_output_hash_is_blake3_of_output_bytes ... ok\ntest witness::tests::append_refusal_records_exit_code_2 ... ok\ntest tests::run_lock_keeps_exit_semantics_when_witness_append_fails ... ok\ntest witness::tests::filter_with_invalid_timestamp_values_yields_no_matches ... ok\ntest witness::tests::no_matches_returns_empty ... ok\ntest tests::run_lock_returns_refusal_for_missing_input_file ... ok\ntest witness::tests::read_ledger_returns_empty_for_missing_file ... ok\ntest witness::tests::append_uses_last_non_empty_line_for_prev ... ok\ntest witness::tests::read_ledger_skips_blank_and_invalid_lines ... ok\ntest witness::tests::read_ledger_parses_jsonl ... ok\ntest witness::tests::append_chains_prev_to_last_record_id ... ok\ntest tests::run_lock_appends_witness_for_lock_partial_by_default ... ok\ntest tests::run_lock_appends_witness_for_lock_created_by_default ... ok\ntest witness::tests::resolve_ledger_path_falls_back_to_home ... ok\ntest witness::tests::resolve_ledger_path_ignores_empty_env_var ... ok\ntest witness::tests::resolve_ledger_path_uses_env_var ... ok\ntest tests::run_lock_appends_witness_for_refusal_by_default ... ok\ntest tests::run_lock_no_witness_suppresses_append ... ok\n\ntest result: ok. 102 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.01s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 7 tests\ntest smoke_witness_last_empty_ledger_json_exits_1 ... ok\ntest smoke_witness_query_empty_ledger_json_exits_1 ... ok\ntest smoke_witness_count_json_returns_total ... ok\ntest smoke_main_refusal_exit_2_and_refusal_envelope ... ok\ntest smoke_witness_query_outcome_filter_works ... ok\ntest smoke_main_lock_created_exit_0_and_json_contract ... ok\ntest smoke_main_lock_partial_exit_1_and_json_contract ... ok\n\ntest result: ok. 7 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.51s\n\n\nrunning 13 tests\ntest vacuum_only_records_refuse_missing_hash ... ok\ntest falls_back_to_path_when_relative_path_absent ... ok\ntest relative_path_preferred_over_absolute_path ... ok\ntest windows_paths_normalized_in_spine_output ... ok\ntest warning_detail_non_string_values_rendered ... ok\ntest single_file_pipeline ... ok\ntest records_with_mixed_versions_accepted ... ok\ntest all_skipped_records_creates_partial_with_zero_members ... ok\ntest extra_upstream_fields_do_not_break_lock ... ok\ntest hash_v0_pipeline_creates_lock ... ok\ntest full_pipeline_vacuum_hash_fingerprint_creates_lock ... ok\ntest mixed_pipeline_with_skips_creates_partial_lock ... ok\ntest large_dataset_deterministic_output ... ok\n\ntest result: ok. 13 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.01s\n\n\nrunning 2 tests\ntest golden_refusal_missing_hash_matches_fixture ... ok\ntest golden_lockfile_render_matches_fixture ... ok\n\ntest result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 37 tests\ntest lock_created_exit_code_is_zero ... ok\ntest lock_partial_exit_code_is_one ... ok\ntest lock_created_includes_all_metadata_fields ... ok\ntest lock_hash_matches_pattern ... ok\ntest lock_created_profiles_always_empty_in_v0 ... ok\ntest lock_partial_skipped_entry_carries_warnings ... ok\ntest lock_partial_with_skipped_records ... ok\ntest lockfile_output_has_all_required_schema_fields ... ok\ntest lock_created_with_all_valid_records ... ok\ntest lock_created_nullable_fields_are_null_when_omitted ... ok\ntest lock_created_self_hash_verifies ... ok\ntest lock_partial_self_hash_verifies ... ok\ntest member_has_required_fields ... ok\ntest deterministic_output_for_same_input ... ok\ntest refusal_envelope_e_bad_input_parse ... ok\ntest refusal_envelope_e_bad_input_version ... ok\ntest refusal_envelope_e_empty ... ok\ntest output_has_sorted_member_keys ... ok\ntest output_has_sorted_top_level_keys ... ok\ntest refusal_envelope_has_exactly_four_refusal_keys ... ok\ntest refusal_exit_code_is_two ... ok\ntest refusal_envelope_e_missing_hash ... ok\ntest refusal_envelope_has_exactly_three_top_level_keys ... ok\ntest output_is_compact_json ... ok\ntest members_sorted_by_path_lexicographic ... ok\ntest run_lock_exit_2_for_missing_file ... ok\ntest skipped_sorted_by_path_lexicographic ... ok\ntest skipped_entry_has_required_fields ... ok\ntest tool_versions_merged_from_input_records ... ok\ntest run_lock_exit_2_for_empty_file ... ok\ntest self_hash_round_trip_with_all_field_types ... ok\ntest tampering_any_field_breaks_self_hash ... ok\ntest run_lock_exit_2_for_missing_hash ... ok\ntest run_lock_exit_2_for_bad_version ... ok\ntest run_lock_exit_2_for_invalid_json ... ok\ntest run_lock_exit_1_for_partial_input ... ok\ntest run_lock_exit_0_for_valid_input ... ok\n\ntest result: ok. 37 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 33 tests\ntest classification_requires_size_field ... ok\ntest backslash_paths_normalized_to_forward_slash ... ok\ntest classification_sorts_members_lexicographically ... ok\ntest classification_requires_path_field ... ok\ntest empty_string_bytes_hash_treated_as_missing ... ok\ntest fingerprint_absent_yields_none ... ok\ntest fingerprint_null_yields_none ... ok\ntest end_to_end_parse_validate_classify_lock_created ... ok\ntest fingerprint_present_and_matched ... ok\ntest end_to_end_parse_validate_classify_lock_partial ... ok\ntest fingerprint_present_but_not_matched ... ok\ntest hydrate_first_seen_version_wins ... ok\ntest hydrate_merges_tool_versions_across_records ... ok\ntest hydrate_records_without_tool_versions_ignored ... ok\ntest missing_hash_detected_for_non_skipped_records ... ok\ntest missing_hash_reports_unknown_when_no_path_field ... ok\ntest missing_hash_uses_path_fallback_when_relative_path_absent ... ok\ntest missing_hash_sample_paths_capped_at_five ... ok\ntest missing_skipped_field_requires_hash ... ok\ntest single_record_jsonl ... ok\ntest skipped_false_requires_hash ... ok\ntest skipped_records_carry_warnings_through_classification ... ok\ntest skipped_true_exempts_from_missing_hash_check ... ok\ntest skipped_with_empty_warnings_array ... ok\ntest skipped_with_no_warnings_field ... ok\ntest trailing_newline_does_not_create_extra_record ... ok\ntest unicode_paths_preserved ... ok\ntest version_gate_rejects_empty_string_version ... ok\ntest version_gate_accepts_all_known_versions ... ok\ntest version_gate_rejects_future_version ... ok\ntest version_gate_rejects_numeric_version ... ok\ntest version_gate_stops_at_first_bad_version ... ok\ntest whitespace_only_bytes_hash_treated_as_missing ... ok\n\ntest result: ok. 33 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 13 tests\ntest witness_record_deserializes_with_missing_optional_fields ... ok\ntest witness_record_round_trip_through_serde ... ok\ntest filter_since_uses_rfc3339_instant_semantics_for_offsets ... ok\ntest read_ledger_handles_extra_fields_gracefully ... ok\ntest filter_by_input_hash_no_match ... ok\ntest read_ledger_handles_minimal_record ... ok\ntest malformed_timestamps_do_not_match_since_until_filters ... ok\ntest filter_by_input_hash_with_null_inputs ... ok\ntest filter_by_input_hash_substring ... ok\ntest records_without_timestamps_handled_in_filters ... ok\ntest filter_since_and_until_window ... ok\ntest filter_all_criteria_combined ... ok\ntest read_ledger_handles_records_from_other_tools ... ok\n\ntest result: ok. 13 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 6 tests\ntest schema_file_is_valid_and_compiles ... ok\ntest schema_rejects_missing_required_id ... ok\ntest schema_validates_lock_created_witness_record ... ok\ntest schema_rejects_invalid_outcome_value ... ok\ntest schema_validates_refusal_witness_record ... ok\ntest schema_rejects_invalid_hash_format ... ok\n\ntest result: ok. 6 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.03s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s ✅","created_at":"2026-02-25T02:56:14Z"},{"id":11,"issue_id":"bd-1cj","author":"SunnyLynx","text":"Closure note (corrected):\n- Updated .github/workflows/release.yml to ensure release parity assets include:\n  - multi-target archives from matrix build\n  - SHA256SUMS plus keyless cosign signature/certificate\n  - SBOM file generation (SPDX JSON)\n  - provenance attestation bundle generated from SHA256SUMS and included in release assets\n  - rerun-safe release upload via gh release upload --clobber\n- Updated README release guardrails bullets to document these release outputs.\n\nValidation commands (local):\n- cargo check --all-targets (pass)\n- cargo fmt --check (pass)\n- cargo clippy --all-targets -- -D warnings (pass)\n- cargo test (pass)\n","created_at":"2026-02-25T02:56:27Z"}]}
{"id":"bd-1ez","title":"Coverage uplift: implement prioritized missing unit/smoke/integration/golden tests","description":"Implement the highest-risk test gaps identified in the parity audit.\n\nDesign:\n- Add regression/golden tests for deterministic lock output and refusal envelopes.\n- Add smoke/e2e CLI path tests for outcome/exit-code routing and witness behaviors.\n- Add targeted integration tests for edge cases (timestamp filters, malformed records, missing fields, skipped semantics).\n\nAcceptance criteria:\n- New tests cover all P0/P1 gaps from audit bead.\n- Tests are deterministic and stable across platforms.\n- cargo fmt --check, cargo clippy --all-targets -- -D warnings, cargo test all pass.\n- README/AGENTS testing guidance updated if workflow changes.","status":"closed","priority":1,"issue_type":"feature","assignee":"MagentaLake","created_at":"2026-02-25T02:47:06.393302Z","created_by":"zac","updated_at":"2026-02-25T02:55:42.413950Z","closed_at":"2026-02-25T02:55:42.413844Z","close_reason":"Done. Implemented P0 binary smoke tests and P1 golden + witness-schema validation from bd-1ke audit; fmt/clippy/test all pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["coverage","golden","lock","testing"],"dependencies":[{"issue_id":"bd-1ez","depends_on_id":"bd-1ke","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1ez","depends_on_id":"bd-3c5","type":"parent-child","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":12,"issue_id":"bd-1ez","author":"Zac","text":"Starting now (dependent from bd-1ke). Implementing prioritized P0/P1 coverage gaps: binary process smoke tests first, then golden/schema-focused coverage if time permits in this pass.","created_at":"2026-02-25T02:50:25Z"},{"id":13,"issue_id":"bd-1ez","author":"Zac","text":"Implemented prioritized P0/P1 coverage uplift from audit:\n\nP0 process-smoke coverage:\n- Added  with binary-level () routing tests for main outcomes and witness subcommands:\n  - LOCK_CREATED exit 0 + JSON contract\n  - LOCK_PARTIAL exit 1 + JSON contract\n  - REFUSAL exit 2 + refusal envelope\n  - witness query/last empty-ledger semantics\n  - witness count JSON semantics\n  - witness outcome filter semantics\n\nP1 golden/schema coverage:\n- Added fixture-backed golden tests in  + fixtures under  for deterministic lock output and refusal envelope serialization.\n- Added witness schema contract  and validation tests in  (valid created/refusal records from binary runs + invalid mutation checks).\n- Added dev dependency  in .\n\nValidation commands:\n- cargo fmt --check\n- cargo clippy --all-targets -- -D warnings\n- cargo test\n\nResults:\n- All gates pass; total test suite now includes new smoke/golden/schema coverage and remains green.","created_at":"2026-02-25T02:55:23Z"},{"id":14,"issue_id":"bd-1ez","author":"Zac","text":"Implemented prioritized P0/P1 coverage uplift from audit.\n\nP0 process-smoke coverage:\n- Added `tests/cli_smoke.rs` with binary-level (`CARGO_BIN_EXE_lock`) routing tests for main outcomes and witness subcommands:\n  - LOCK_CREATED exit 0 + JSON contract\n  - LOCK_PARTIAL exit 1 + JSON contract\n  - REFUSAL exit 2 + refusal envelope\n  - witness query/last empty-ledger semantics\n  - witness count JSON semantics\n  - witness outcome filter semantics\n\nP1 golden/schema coverage:\n- Added fixture-backed golden tests in `tests/golden_outputs.rs` + fixtures under `tests/fixtures/golden/` for deterministic lock output and refusal envelope serialization.\n- Added witness schema contract `schemas/witness-v0.schema.json` and validation tests in `tests/witness_schema.rs` (valid created/refusal records from binary runs + invalid mutation checks).\n- Added dev dependency `jsonschema = 0.42` in `Cargo.toml`.\n\nValidation commands:\n- `cargo fmt --check`\n- `cargo clippy --all-targets -- -D warnings`\n- `cargo test`\n\nResult:\n- All gates pass with new smoke/golden/schema coverage.\n","created_at":"2026-02-25T02:55:42Z"}]}
{"id":"bd-1jj","title":"Implement witness append integration and no-witness behavior","description":"Implement witness append integration for all domain outcomes with --no-witness opt-out.\n\nWitness behavior must mirror spine conventions and never corrupt domain exit semantics.","design":"- Resolve ledger path from EPISTEMIC_WITNESS then ~/.epistemic/witness.jsonl.\n- Append witness records for LOCK_CREATED, LOCK_PARTIAL, and REFUSAL outcomes.\n- Preserve domain exit code when witness append fails; emit warning only.","acceptance_criteria":"- Default run appends one witness record per invocation.\n- --no-witness suppresses append.\n- Append failures do not change exit 0/1/2 semantics.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":1,"issue_type":"feature","assignee":"MagentaLake","created_at":"2026-02-24T23:25:31.621147Z","created_by":"zac","updated_at":"2026-02-25T00:03:03.712395Z","closed_at":"2026-02-25T00:01:47.833520Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["ledger","lock","wave-3","witness"],"dependencies":[{"issue_id":"bd-1jj","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":15,"issue_id":"bd-1jj","author":"Zac","text":"Resuming now after context refresh. Implementing witness append integration across LOCK_CREATED/LOCK_PARTIAL/REFUSAL with --no-witness opt-out, preserving domain exit semantics.","created_at":"2026-02-24T23:59:14Z"},{"id":16,"issue_id":"bd-1jj","author":"Zac","text":"Implemented witness append integration end-to-end in orchestration with tests covering LOCK_CREATED/LOCK_PARTIAL/REFUSAL append outcomes, --no-witness suppression, and append-failure exit-code stability. Added deterministic env lock for test env mutation in witness tests.","created_at":"2026-02-25T00:03:03Z"}]}
{"id":"bd-1ke","title":"Coverage parity audit: map lock vs rvl unit/smoke/integration/golden gaps","description":"Produce a concrete parity map of lock tests against rvl-style quality depth.\n\nDesign:\n- Inventory current lock coverage by layer (unit, integration, smoke/e2e, golden/regression).\n- Compare against rvl test patterns and classify missing coverage by risk.\n- Propose minimal high-value additions with file-level implementation plan.\n\nAcceptance criteria:\n- Written gap report checked into repo docs/tests planning area.\n- Missing tests are prioritized (P0/P1/P2) with rationale.\n- Follow-up implementation beads are linked from the audit output.","status":"closed","priority":1,"issue_type":"task","assignee":"MagentaLake","created_at":"2026-02-25T02:47:06.333793Z","created_by":"zac","updated_at":"2026-02-25T02:55:42.344762Z","closed_at":"2026-02-25T02:55:42.344555Z","close_reason":"Done. Added docs/coverage-parity-audit.md with prioritized parity gaps and file-level implementation plan; gates passed (fmt/clippy/test).","source_repo":".","compaction_level":0,"original_size":0,"labels":["audit","coverage","lock","testing"],"dependencies":[{"issue_id":"bd-1ke","depends_on_id":"bd-3c5","type":"parent-child","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":17,"issue_id":"bd-1ke","author":"Zac","text":"Starting now (Track B primary). I will audit lock vs rvl test layers (unit/smoke/integration/golden), produce a prioritized P0/P1/P2 gap report in docs, then run fmt/clippy/test before closing.","created_at":"2026-02-25T02:48:47Z"},{"id":18,"issue_id":"bd-1ke","author":"Zac","text":"Coverage parity audit completed in docs/coverage-parity-audit.md (lock vs rvl unit/smoke/integration/golden mapping). Prioritized gaps documented as P0/P1/P2 with implementation routing to bd-1ez. Validation run: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-25T02:50:25Z"}]}
{"id":"bd-1ub","title":"Implement describe/schema output paths with embedded artifacts","description":"Implement --describe and --schema outputs with embedded artifacts.\n\nThese are required for agent/automation introspection and contract verification.","design":"- Add/maintain operator.json and lock.v0 schema artifacts in repo.\n- Wire CLI to emit artifacts verbatim and exit 0 before input validation.\n- Keep artifact versioning synchronized with lock package version and output schema.","acceptance_criteria":"- `lock --describe` emits operator.json on stdout with exit 0.\n- `lock --schema` emits lock schema on stdout with exit 0.\n- Emitted artifacts validate as JSON and remain deterministic.","notes":"Implemented --describe and --schema output paths. Created schemas/lock-v0.schema.json with full JSON Schema for lock.v0 output (members, skipped entries, fingerprint results, warnings). Both use include_str! for compile-time embedding. dispatch_describe() emits operator.json, dispatch_schema() emits lock schema, both exit 0. 4 new tests (valid JSON parsing, exit code 0). 63 total tests pass, fmt+clippy clean.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:25:31.934760Z","created_by":"zac","updated_at":"2026-02-24T23:49:53.399122Z","closed_at":"2026-02-24T23:49:53.398989Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["lock","operator","schema","wave-2"],"dependencies":[{"issue_id":"bd-1ub","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1ub","depends_on_id":"bd-3w1","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2jb","title":"Release guardrails: version bump flow and artifact publish verification","description":"Harden lock release flow so version bumps and artifact publishing are deterministic and verifiable.","design":"- Define/implement release workflow expectations (version source of truth, lockfile sync, --locked behavior).\n- Add publish verification steps (run status + release existence checks).\n- Document an explicit release checklist for maintainers and agents.","acceptance_criteria":"- Release workflow fails clearly when version/lockfile state is invalid.\n- Release publish verification steps are documented and reproducible.\n- Maintainer checklist covers bump, push, and release validation.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":2,"issue_type":"task","assignee":"MagentaLake","created_at":"2026-02-24T23:30:27.070573Z","created_by":"zac","updated_at":"2026-02-24T23:57:27.456235Z","closed_at":"2026-02-24T23:57:27.456125Z","close_reason":"Release workflow and maintainer verification guardrails added","source_repo":".","compaction_level":0,"original_size":0,"labels":["automation","lock","release","wave-4"],"dependencies":[{"issue_id":"bd-2jb","depends_on_id":"bd-3ro","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":19,"issue_id":"bd-2jb","author":"FrostyHollow","text":"Starting bd-2jb now (release guardrails). Scope: add release workflow checks for version/Cargo.lock validity and document reproducible release verification checklist.","created_at":"2026-02-24T23:56:21Z"},{"id":20,"issue_id":"bd-2jb","author":"MagentaLake","text":"Start update: implementing release guardrails docs/workflow for version + Cargo.lock validation and publish verification steps.","created_at":"2026-02-24T23:56:44Z"},{"id":21,"issue_id":"bd-2jb","author":"FrostyHollow","text":"Implemented release guardrails: added .github/workflows/release.yml with version-match preflight, locked dependency verification, fmt/clippy/test gates, cargo publish --dry-run --locked verification, tag/release creation, and optional publish=true crates.io step. Added README release-guardrails section with reproducible maintainer checklist and gh verification commands. Validation passed: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:57:27Z"}]}
{"id":"bd-2kh","title":"Implement canonical JSON serializer with sorted keys at all levels","description":"Implement canonical JSON serialization with sorted keys at every object level.\n\nThis is the basis for deterministic self-hash and cross-platform reproducibility.","design":"- Define a canonical serializer strategy aligned with PLAN constraints.\n- Ensure top-level keys are sorted (not struct declaration order).\n- Emit compact JSON without trailing newline artifacts.","acceptance_criteria":"- Same semantic input yields byte-identical canonical output with fixed timestamp.\n- Nested and top-level keys are deterministically ordered.\n- Canonical serializer is covered by deterministic tests.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.626139Z","created_by":"zac","updated_at":"2026-02-24T23:44:17.048720Z","closed_at":"2026-02-24T23:44:17.048624Z","close_reason":"Canonical serializer and deterministic tests complete","source_repo":".","compaction_level":0,"original_size":0,"labels":["canonicalization","determinism","lock","wave-1"],"dependencies":[{"issue_id":"bd-2kh","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":22,"issue_id":"bd-2kh","author":"FrostyHollow","text":"Starting bd-2kh now. Scope: canonical JSON serializer with sorted keys at every object level plus deterministic tests. I will reserve only exact files actively edited and post validation results on finish.","created_at":"2026-02-24T23:42:51Z"},{"id":23,"issue_id":"bd-2kh","author":"FrostyHollow","text":"Implemented canonical JSON serializer in src/lockfile/self_hash.rs with recursive key sorting at every object level and deterministic compact output (no trailing newline). Added tests for nested sorting, semantic determinism, and newline behavior. Added Serialize derives to lockfile structs for canonical serialization inputs. Validation passed: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:44:12Z"}]}
{"id":"bd-2ku","title":"Integration tests: outcomes, refusal envelopes, deterministic ordering","description":"Add integration tests for main command outcomes and output contracts.\n\nThis is the operator-facing confidence layer for lock.v0 behavior.","design":"- Cover LOCK_CREATED, LOCK_PARTIAL, and REFUSAL scenarios end-to-end.\n- Assert output JSON shape, exit codes, and deterministic member ordering.\n- Include unknown-version and empty-input refusal paths.","acceptance_criteria":"- Integration matrix covers all domain outcomes.\n- Golden/snapshot assertions guard key output fields and refusal codes.\n- Exit-code assertions are explicit and stable.","notes":"DONE: 37 integration tests in tests/integration_outcomes.rs covering: LOCK_CREATED (exit 0, self-hash verifies, metadata fields, nullable nulls, profiles empty), LOCK_PARTIAL (exit 1, skipped records, warnings, self-hash verifies), REFUSAL (exit 2, E_EMPTY/E_BAD_INPUT/E_MISSING_HASH envelopes, structure contracts), deterministic ordering (members/skipped sorted by path), canonical JSON (sorted keys at all levels, compact, no trailing newline), self-hash integrity (round-trip with all field types, tampering detection), tool version merging, run_lock exit codes (7 file-based tests: valid/partial/missing/empty/bad-version/missing-hash/invalid-json), schema-level structural assertions. NOTE: pre-existing flaky test in witness module (append_chains_prev_to_last_record_id) due to env var race condition in parallel test runs — not related to bd-2ku.","status":"closed","priority":1,"issue_type":"task","assignee":"SunnyLynx","created_at":"2026-02-24T23:25:32.594311Z","created_by":"zac","updated_at":"2026-02-25T00:01:53.755676Z","closed_at":"2026-02-25T00:01:53.755569Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","lock","tests"],"dependencies":[{"issue_id":"bd-2ku","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2mx","title":"Witness ledger hardening: TOCTOU race + read_last_record_id perf","status":"closed","priority":3,"issue_type":"task","assignee":"MagentaLake","created_at":"2026-02-25T02:21:12.274415Z","created_by":"zac","updated_at":"2026-02-25T02:46:16.358695Z","closed_at":"2026-02-25T02:45:54.734435Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":24,"issue_id":"bd-2mx","author":"Zac","text":"TOCTOU race in append_witness_record_to (lines 205, 253): two concurrent lock processes can fork the prev chain. Fix: advisory file locking. read_last_record_id (line 264) reads entire file on every append. Fix: seek-from-end or sidecar cache. Both witness-layer only; per spec witness failures do not alter domain outcomes.","created_at":"2026-02-25T02:21:30Z"},{"id":25,"issue_id":"bd-2mx","author":"Zac","text":"Starting now. Implementing witness append hardening for concurrent writers (advisory lock) and improving read_last_record_id performance without full-file read, plus tests.","created_at":"2026-02-25T02:44:10Z"},{"id":26,"issue_id":"bd-2mx","author":"Zac","text":"Addressed both scope items in witness append path (src/witness/mod.rs): (1) TOCTOU chain race hardening by taking an exclusive advisory lock on the ledger file before reading prev id and appending; (2) last-record lookup perf by replacing full-file read with seek-from-end scan of only the last non-empty line (read_last_non_empty_line). Repro context: concurrent appends can otherwise fork prev chain; full-file read grows linearly with ledger size. Validation includes append chain tests and trailing-empty-line prev resolution test plus full gate commands.","created_at":"2026-02-25T02:45:36Z"},{"id":27,"issue_id":"bd-2mx","author":"Zac","text":"Fixed by FrostyHollow: advisory flock + seek-from-end. Tests pass. ChartreuseForest verified and closing.","created_at":"2026-02-25T02:45:54Z"},{"id":28,"issue_id":"bd-2mx","author":"Zac","text":"Implemented witness ledger hardening in src/witness/mod.rs: append now acquires an exclusive advisory lock before reading prev and appending, removing the TOCTOU window; read_last_record_id now uses reverse tail scanning (read_last_non_empty_line) instead of full-file read to avoid O(file_size) read amplification on each append. Repro covered: concurrent writers could previously observe same prev and fork chain; large ledgers previously re-read entirely per append. Added regression test: witness::tests::append_uses_last_non_empty_line_for_prev, plus existing chain test still passes. Validation run: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test; ubs (production/runtime triage only: no new actionable production issues from this change).","created_at":"2026-02-25T02:46:16Z"}]}
{"id":"bd-2oz","title":"Implement record version gate and required-field validation","description":"Implement version compatibility gate and required-field validation for non-skipped records.\n\nlock must only accept known upstream record versions and must refuse incomplete non-skipped records.","design":"- Accept only vacuum.v0/hash.v0/fingerprint.v0 as input record versions.\n- Refuse unknown or missing versions with E_BAD_INPUT detail.\n- Validate required fields for non-skipped records and accumulate missing-hash samples for E_MISSING_HASH.","acceptance_criteria":"- Unknown version records refuse deterministically with line/detail context.\n- Missing bytes_hash on non-skipped records triggers E_MISSING_HASH.\n- Skipped records do not trigger missing-hash refusal.","notes":"Version gate and required-field validation already implemented in src/input/mod.rs by another agent. Verified: accepts vacuum.v0/hash.v0/fingerprint.v0, rejects unknown/missing versions, collects missing bytes_hash paths with sample limit, skips _skipped records for hash check. 47 tests pass, fmt+clippy clean.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.196489Z","created_by":"zac","updated_at":"2026-02-24T23:47:41.300252Z","closed_at":"2026-02-24T23:47:41.300143Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["input","lock","validation"],"dependencies":[{"issue_id":"bd-2oz","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":29,"issue_id":"bd-2oz","author":"MagentaLake","text":"Start update: implementing version gate and non-skipped required-field validation in src/input/mod.rs with deterministic refusal-oriented error details and tests.","created_at":"2026-02-24T23:44:40Z"}]}
{"id":"bd-2u2","title":"Treat empty EPISTEMIC_WITNESS as unset","description":"Repro: run lock with EPISTEMIC_WITNESS set to empty string (e.g., EPISTEMIC_WITNESS='' lock ...). Current behavior resolves ledger path to empty path and append emits warning: 'No such file or directory', so witness is not recorded despite default-append semantics. Impact: user-facing reliability bug in production runs with misconfigured env; domain exit remains correct but audit trail is silently missing except stderr warning. Proposed fix: in resolve_ledger_path(), treat empty/whitespace env value as unset and fall back to ~/.epistemic/witness.jsonl. Add regression test.","status":"closed","priority":1,"issue_type":"bug","assignee":"MagentaLake","created_at":"2026-02-25T02:17:59.985575Z","created_by":"zac","updated_at":"2026-02-25T02:19:10.135103Z","closed_at":"2026-02-25T02:19:10.134970Z","close_reason":"Done. Validated with cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test (all passing).","source_repo":".","compaction_level":0,"original_size":0,"labels":["bug","reliability","witness"],"comments":[{"id":30,"issue_id":"bd-2u2","author":"Zac","text":"Reproduced in production path: EPISTEMIC_WITNESS='' causes witness append warning and no ledger write. Implementing fallback-to-default behavior now with regression test.","created_at":"2026-02-25T02:18:03Z"},{"id":31,"issue_id":"bd-2u2","author":"Zac","text":"Fixed in src/witness/mod.rs: resolve_ledger_path now ignores empty/whitespace EPISTEMIC_WITNESS and falls back to ~/.epistemic/witness.jsonl. Added regression test resolve_ledger_path_ignores_empty_env_var. Repro before fix: EPISTEMIC_WITNESS='' caused witness append warning and no ledger write.","created_at":"2026-02-25T02:19:10Z"}]}
{"id":"bd-30f","title":"Implement lockfile output renderer and outcome mapping","description":"Implement lockfile renderer for LOCK_CREATED and LOCK_PARTIAL artifact outputs.\n\nThis bead focuses on non-refusal lock.v0 artifact emission only.","design":"- Assemble final top-level lockfile object with required counts and fields.\n- Emit stdout JSON artifact for exits 0/1 only.\n- Keep output deterministic and canonical-serializer friendly.","acceptance_criteria":"- LOCK_CREATED output has skipped_count=0 and exit 0.\n- LOCK_PARTIAL output has skipped_count>0 and exit 1.\n- No refusal-envelope logic is duplicated here (handled by refusal/orchestrator beads).","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","assignee":"MagentaLake","created_at":"2026-02-24T23:24:53.924186Z","created_by":"zac","updated_at":"2026-02-24T23:50:29.470770Z","closed_at":"2026-02-24T23:50:29.470656Z","close_reason":"Implemented lockfile output renderer and outcome mapping with tests and full gate pass","source_repo":".","compaction_level":0,"original_size":0,"labels":["contract","lock","output"],"dependencies":[{"issue_id":"bd-30f","depends_on_id":"bd-3dl","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-30f","depends_on_id":"bd-3un","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-30f","depends_on_id":"bd-8em","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":32,"issue_id":"bd-30f","author":"MagentaLake","text":"Start update: implementing LOCK_CREATED/LOCK_PARTIAL artifact renderer and outcome mapping in src/output/mod.rs with deterministic JSON tests.","created_at":"2026-02-24T23:49:20Z"},{"id":33,"issue_id":"bd-30f","author":"MagentaLake","text":"Finish update: implemented output artifact renderer in src/output/mod.rs with explicit LOCK_CREATED/LOCK_PARTIAL mapping and canonical JSON rendering; added unit tests for outcome mapping and compact JSON output. Validation passed: cargo fmt --check; cargo check --all-targets; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:50:29Z"}]}
{"id":"bd-367","title":"Unit tests: canonical serialization and self-hash determinism","description":"Add deterministic unit tests for canonical serialization and self-hash verification.\n\nThese tests are the guardrail against silent lock integrity regressions.","design":"- Test canonical key ordering and stable byte output for fixed inputs.\n- Test lock_hash compute/verify round-trip and tamper detection.\n- Include cross-field perturbation cases to ensure hash sensitivity.","acceptance_criteria":"- Determinism tests pass across repeated runs.\n- Verification helper catches modified payloads.\n- Serialization tests assert top-level and nested key ordering assumptions.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T23:25:32.385883Z","created_by":"zac","updated_at":"2026-02-24T23:57:55.528465Z","closed_at":"2026-02-24T23:57:55.528365Z","close_reason":"Determinism and self-hash verification test guardrails complete","source_repo":".","compaction_level":0,"original_size":0,"labels":["hashing","lock","tests","unit"],"dependencies":[{"issue_id":"bd-367","depends_on_id":"bd-2kh","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-367","depends_on_id":"bd-8em","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":34,"issue_id":"bd-367","author":"FrostyHollow","text":"Starting bd-367 now. Scope: strengthen canonical-serialization/self-hash deterministic tests with explicit key-order and tamper-detection assertions.","created_at":"2026-02-24T23:51:03Z"},{"id":35,"issue_id":"bd-367","author":"FrostyHollow","text":"Added new determinism tests in src/lockfile/self_hash.rs for (1) explicit top-level+nested key ordering on lockfile canonical JSON and (2) nested member tamper detection in verify_from_json. File-level fmt check passes (cargo fmt --check -- src/lockfile/self_hash.rs). Full clippy/test currently blocked by unrelated in-progress witness compile errors (WitnessRecord missing Serialize derive in src/witness/mod.rs).","created_at":"2026-02-24T23:52:12Z"},{"id":36,"issue_id":"bd-367","author":"FrostyHollow","text":"Continuing bd-367 now after context refresh; keeping reservations file-specific and proceeding with validation/close path.","created_at":"2026-02-24T23:55:36Z"},{"id":37,"issue_id":"bd-367","author":"FrostyHollow","text":"Validation blocked by unrelated clippy errors in src/witness/mod.rs (collapsible-if warnings in active witness work). Pausing and switching to next unblocked ready bead per coordination rule.","created_at":"2026-02-24T23:56:04Z"},{"id":38,"issue_id":"bd-367","author":"FrostyHollow","text":"Resuming bd-367 after blocker cleared. Determinism tests already added in src/lockfile/self_hash.rs; proceeding to close with successful full gate results.","created_at":"2026-02-24T23:57:44Z"},{"id":39,"issue_id":"bd-367","author":"FrostyHollow","text":"Completed bd-367: added deterministic self-hash/canonicalization coverage in src/lockfile/self_hash.rs, including explicit lockfile top-level+nested key-order assertions and nested-member tamper detection for verify_from_json. Full local gate now passes: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:57:51Z"}]}
{"id":"bd-36t","title":"LOCK v0 epic: deterministic dataset lockfile implementation","description":"Implement lock.v0 end-to-end from docs/PLAN.md as an artifact-grade, deterministic, self-hashed lockfile tool.\n\nThis epic tracks delivery of CLI, input handling, refusal semantics, canonical serialization, self-hash, witness parity, and test coverage.","design":"Execution strategy:\n- Build lock in modular slices: CLI, input pipeline, lockfile assembly, canonical/self-hash, witness, output.\n- Keep behavior deterministic and refusal-first when ambiguity exists.\n- Validate every contract against the plan, not inferred behavior.","acceptance_criteria":"- All child beads in this epic are closed.\n- The lock binary implements LOCK_CREATED/LOCK_PARTIAL/REFUSAL semantics exactly.\n- Evidence-grade tests pass and CI gate is green.","notes":"Use this epic as the swarm umbrella; all implementation beads should reference this item.","status":"deferred","priority":0,"issue_type":"epic","created_at":"2026-02-24T23:23:50.040845Z","created_by":"zac","updated_at":"2026-02-24T23:30:40.638135Z","defer_until":"2027-02-24T23:27:12.734793Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["epic","lock","spine","umbrella","v0"]}
{"id":"bd-3c0","title":"Implement refusal model and REFUSAL envelope contracts","description":"Implement refusal data model and envelope rendering for E_EMPTY, E_BAD_INPUT, and E_MISSING_HASH.\n\nRefusals must be machine-actionable and include concrete next steps.","design":"- Define refusal code enum and detail payloads for each refusal scenario.\n- Implement refusal JSON envelope writer with `version`, `outcome`, and `refusal` object.\n- Provide deterministic next_command generation for recovery paths.","acceptance_criteria":"- Envelope shape matches docs/PLAN.md examples and detail schemas.\n- Unknown/missing fields are not emitted ad hoc.\n- Refusal renderer is reusable across parse/input/orchestration failures.","notes":"Implementation complete. Enhanced existing stub with: MAX_SAMPLE_PATHS truncation (5), singular/plural message handling, 17 unit tests covering all refusal codes, canonical JSON key sorting, determinism, compactness. All tests pass, fmt+clippy clean.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:52.908650Z","created_by":"zac","updated_at":"2026-02-24T23:43:47.677200Z","closed_at":"2026-02-24T23:42:50.240466Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","lock","refusal"],"dependencies":[{"issue_id":"bd-3c0","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3c4","title":"Witness tests: append behavior, filters, and subcommand exits","description":"## Context\nAdd witness behavior tests for append/query/count/last and no-witness behavior.\n\nThis ensures parity with spine witness semantics and prevents regressions.\n\n## Implementation Plan\n- Test append on LOCK_CREATED/LOCK_PARTIAL/REFUSAL outcomes.\n- Test --no-witness suppression and append failure non-interference.\n- Test query filters and no-match exit semantics.\n\n## Acceptance Criteria\n- Witness tests validate both happy-path and degraded ledger scenarios.\n- Domain exits remain stable under witness write/read failures.\n- Query/last/count commands produce expected records and counts.\n\n## Definition of Done\nDefinition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","design":"- Test append on LOCK_CREATED/LOCK_PARTIAL/REFUSAL outcomes.\n- Test --no-witness suppression and append failure non-interference.\n- Test query filters and no-match exit semantics.","acceptance_criteria":"- Witness tests validate both happy-path and degraded ledger scenarios.\n- Domain exits remain stable under witness write/read failures.\n- Query/last/count commands produce expected records and counts.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":2,"issue_type":"task","assignee":"ChartreuseForest","created_at":"2026-02-24T23:25:32.751155Z","created_by":"zac","updated_at":"2026-02-25T00:04:29.501722Z","closed_at":"2026-02-25T00:04:29.501616Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["lock","tests","witness"],"dependencies":[{"issue_id":"bd-3c4","depends_on_id":"bd-125","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3c4","depends_on_id":"bd-1jj","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3c5","title":"Close parity gaps vs rvl: release workflow + test coverage","description":"Track and close the highest-value parity gaps between lock and rvl in release automation and verification depth.\n\nThis workstream should bring lock to rvl-grade release confidence while preserving lock-specific scope and contracts.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-25T02:46:37.281539Z","created_by":"zac","updated_at":"2026-02-25T02:57:41.134456Z","closed_at":"2026-02-25T02:57:41.134343Z","close_reason":"All child beads closed: bd-1cj (release artifact matrix + checksums + SBOM + provenance), bd-dj6 (Homebrew tap automation), bd-1ke (coverage parity audit), bd-1ez (coverage uplift with P0/P1 gaps). lock is now at rvl-grade release confidence with 223 tests across all four layers.","source_repo":".","compaction_level":0,"original_size":0,"labels":["lock","parity","release","testing"]}
{"id":"bd-3dl","title":"Implement member/skipped classification and deterministic ordering","description":"Implement member/skipped classification, path normalization, and deterministic sorting.\n\nThis defines what the lock actually covers and how stable output ordering is guaranteed.","design":"- Route `_skipped: true` records into skipped entries with warnings payload.\n- Normalize member path from `relative_path` with fallback rules from the plan.\n- Sort members and skipped entries by lexicographic byte-order path.","acceptance_criteria":"- skipped_count/member_count reflect actual arrays exactly.\n- LOCK_PARTIAL outcome occurs when skipped array is non-empty.\n- Ordering is deterministic across repeated runs with fixed inputs.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":1,"issue_type":"feature","assignee":"MagentaLake","created_at":"2026-02-24T23:24:53.326155Z","created_by":"zac","updated_at":"2026-02-24T23:46:45.059859Z","closed_at":"2026-02-24T23:46:45.059761Z","close_reason":"Classification and deterministic ordering complete","source_repo":".","compaction_level":0,"original_size":0,"labels":["data-model","lock","lockfile"],"dependencies":[{"issue_id":"bd-3dl","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":40,"issue_id":"bd-3dl","author":"FrostyHollow","text":"Starting bd-3dl now due coordination correction (avoid cli contention). Scope: member/skipped classification, path normalization, and deterministic ordering with tests. I will reserve only exact files actively edited.","created_at":"2026-02-24T23:44:53Z"},{"id":41,"issue_id":"bd-3dl","author":"MagentaLake","text":"Start update: implementing skipped/member classification, relative-path normalization, and deterministic lexicographic sorting in src/lockfile/mod.rs with unit tests.","created_at":"2026-02-24T23:46:02Z"},{"id":42,"issue_id":"bd-3dl","author":"FrostyHollow","text":"Implemented lockfile classification in src/lockfile/mod.rs: member/skipped partitioning, path normalization to forward slashes, deterministic lexicographic sorting for both arrays, computed member_count/skipped_count, and outcome mapping to LOCK_CREATED vs LOCK_PARTIAL. Added unit tests for counts/outcome, deterministic ordering, path fallback/normalization, and missing bytes_hash refusal precondition. Validation passed: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:46:40Z"}]}
{"id":"bd-3hx","title":"Docs hardening: align README/AGENTS/operator/schema with implementation","description":"Finalize README/AGENTS/operator/schema docs so shipped behavior and documentation are in lockstep.\n\nDocs must remain operational for both humans and agent swarms.","design":"- Update examples, flag docs, and outcome/refusal tables to match implementation.\n- Keep AGENTS workflow guidance aligned with actual commands and CI gates.\n- Ensure operator/schema examples and version references are consistent.","acceptance_criteria":"- README examples run against current CLI contract.\n- AGENTS instructions do not contradict implemented behavior.\n- No stale references to deferred or non-existent functionality.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":2,"issue_type":"task","assignee":"MagentaLake","created_at":"2026-02-24T23:25:32.959433Z","created_by":"zac","updated_at":"2026-02-25T00:06:57.304283Z","closed_at":"2026-02-25T00:06:57.304175Z","close_reason":"Done. Validation: jq empty operator.json schemas/lock-v0.schema.json; cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test (all passing).","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","lock","quality"],"dependencies":[{"issue_id":"bd-3hx","depends_on_id":"bd-125","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3hx","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3hx","depends_on_id":"bd-1jj","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3hx","depends_on_id":"bd-1ub","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3hx","depends_on_id":"bd-30f","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":43,"issue_id":"bd-3hx","author":"Zac","text":"Starting now: aligning README/AGENTS/operator/schema with implemented lock.v0 behavior and current CLI/witness semantics.","created_at":"2026-02-25T00:03:33Z"},{"id":44,"issue_id":"bd-3hx","author":"Zac","text":"Progress: updated README/operator/schema to match current implementation (status wording, CLI reference, required-input semantics, schema required fields/detail typing, operator --version). Validation: jq on JSON files passes; cargo test passes. Full cargo fmt --check and cargo clippy --all-targets -- -D warnings are currently blocked by concurrent in-progress changes in tests/e2e_spine.rs (bd-7ot).","created_at":"2026-02-25T00:06:06Z"},{"id":45,"issue_id":"bd-3hx","author":"Zac","text":"Finalized docs-contract alignment: README status/input contract wording updated to current implementation; operator contract now includes --version flag; schema tightened to require nullable top-level metadata keys plus fingerprint/detail fields matching emitted JSON. Full validation now passes.","created_at":"2026-02-25T00:06:57Z"}]}
{"id":"bd-3nw","title":"Implement JSONL input reader with line-aware parse errors","description":"Build JSONL input ingestion from stdin or optional file arg with line-aware diagnostics.\n\nThis is the ingestion backbone for lock member/skipped classification.","design":"- Implement source selection: file path when provided, otherwise stdin.\n- Parse line-by-line JSONL preserving line number context.\n- Map malformed JSON to E_BAD_INPUT with detail including line and parser error.","acceptance_criteria":"- Empty stream is detectable and distinguishable from parse failures.\n- Parse failure details contain actionable location data.\n- Reader supports large inputs without loading all text as one string.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","assignee":"MagentaLake","created_at":"2026-02-24T23:24:53.055625Z","created_by":"zac","updated_at":"2026-02-24T23:43:52.918102Z","closed_at":"2026-02-24T23:43:52.918009Z","close_reason":"Implemented JSONL reader with line-aware parse diagnostics and full validation gate green","source_repo":".","compaction_level":0,"original_size":0,"labels":["input","lock","parsing"],"dependencies":[{"issue_id":"bd-3nw","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":46,"issue_id":"bd-3nw","author":"MagentaLake","text":"Start update: implementing JSONL reader from stdin/file with line-aware parse diagnostics in src/input/mod.rs; reservations scoped to src/input/mod.rs and Cargo.toml.","created_at":"2026-02-24T23:43:00Z"},{"id":47,"issue_id":"bd-3nw","author":"MagentaLake","text":"Finish update: implemented line-by-line JSONL ingestion from stdin/file with line-aware parse diagnostics in src/input/mod.rs; added unit tests for empty stream, parse errors with line context, blank-line rejection, multi-line success, and missing file IO path. Validation run: cargo check --all-targets; cargo clippy --all-targets -- -D warnings; cargo test (all pass).","created_at":"2026-02-24T23:43:52Z"}]}
{"id":"bd-3ql","title":"Witness since/until filtering uses lexicographic timestamp comparison","description":"lock witness query/count currently compare RFC3339 timestamps as raw strings in matches_filters (src/witness/mod.rs), which can produce incorrect results when records or filter values use non-Z offsets.\n\nRepro:\n1. Put two records in a witness ledger: ts=2026-01-01T00:00:00+02:00 and ts=2025-12-31T22:30:00Z.\n2. Run: lock witness query --since 2025-12-31T22:45:00Z --json.\n3. Expected: +02:00 record excluded based on absolute time; actual behavior may differ due to string compare.\n\nImpact:\n- User-facing correctness bug in witness query/count filtering.\n- Misleading counts/results for mixed-offset ledgers, affecting audits/debugging.\n\nProposed fix scope:\n- Parse filter and record timestamps with chrono::DateTime::parse_from_rfc3339 and compare normalized instants.\n- Define fallback behavior for unparsable timestamps and cover with tests.\n- Add mixed-offset and malformed-timestamp test cases.","status":"closed","priority":1,"issue_type":"bug","assignee":"MagentaLake","created_at":"2026-02-25T02:19:11.534147Z","created_by":"FrostyHollow","updated_at":"2026-02-25T02:45:21.717205Z","closed_at":"2026-02-25T02:43:59.999459Z","close_reason":"Done. Validation: cargo test filter_by_since_uses_instant_not_lexicographic_order; cargo test filter_with_invalid_timestamp_values_yields_no_matches; cargo test filter_since_uses_rfc3339_instant_semantics_for_offsets; cargo test malformed_timestamps_do_not_match_since_until_filters.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bug","lock","witness"],"comments":[{"id":48,"issue_id":"bd-3ql","author":"FrostyHollow","text":"Starting fix now per final-pass routing. Repro: lexicographic ts comparison in witness since/until filters can misorder mixed-offset timestamps. Implementing RFC3339 instant comparison + tests.","created_at":"2026-02-25T02:42:02Z"},{"id":49,"issue_id":"bd-3ql","author":"Zac","text":"Starting now. Implementing RFC3339 instant-based since/until filtering in witness query/count, with mixed-offset and malformed timestamp tests.","created_at":"2026-02-25T02:42:19Z"},{"id":50,"issue_id":"bd-3ql","author":"Zac","text":"Fixed production filtering bug in src/witness/mod.rs: since/until now parse RFC3339 and compare absolute instants instead of raw string lexicographic ordering. Repro addressed: mixed-offset ts values now filter correctly. Fallback behavior defined: invalid filter ts or invalid record ts => record does not match since/until constraints. Added regression tests in src/witness/mod.rs and tests/witness_dispatch.rs for mixed-offset and malformed timestamps.","created_at":"2026-02-25T02:43:59Z"},{"id":51,"issue_id":"bd-3ql","author":"Zac","text":"Fixed: timestamp parsing + dispatch sort ordering upgraded. 198 tests pass.","created_at":"2026-02-25T02:45:21Z"}]}
{"id":"bd-3ro","title":"CI guardrails: fmt clippy test and locked-build PR checks","description":"Harden CI checks for lock so PRs fail fast on quality regressions and lockfile drift.","design":"- Add CI workflow gates for fmt/clippy/test.\n- Add locked build verification in CI to catch Cargo.toml/Cargo.lock drift early.\n- Keep failures explicit and actionable in logs.","acceptance_criteria":"- CI fails on formatting/lint/test regressions.\n- Locked-build mismatch is surfaced on PR checks.\n- CI docs or workflow comments explain the gate intent.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T23:25:33.167916Z","created_by":"zac","updated_at":"2026-02-24T23:49:29.143460Z","closed_at":"2026-02-24T23:49:29.143365Z","close_reason":"CI quality and locked-build guardrails added","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci","lock","release"],"dependencies":[{"issue_id":"bd-3ro","depends_on_id":"bd-12h","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":52,"issue_id":"bd-3ro","author":"FrostyHollow","text":"Starting bd-3ro now. Scope: CI guardrails for fmt, clippy, tests, and locked-build drift checks; include workflow documentation/comments for gate intent.","created_at":"2026-02-24T23:48:31Z"},{"id":53,"issue_id":"bd-3ro","author":"FrostyHollow","text":"Added CI workflow at .github/workflows/ci.yml with explicit guardrails: cargo fmt --check, cargo clippy --all-targets -- -D warnings, cargo test, and a separate cargo check --locked --all-targets job to surface Cargo.lock drift in PRs. Workflow includes intent-revealing job/step names and comments via naming. Local validation passed: cargo fmt --check; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:49:26Z"}]}
{"id":"bd-3un","title":"Implement tool_versions accumulation and metadata hydration","description":"Implement metadata hydration and tool_versions accumulation rules.\n\nlock must preserve provenance across all records, including skipped inputs.","design":"- Merge `tool_versions` from every input record (members + skipped).\n- Keep first-seen version on tool collisions and append lock's own version.\n- Populate top-level dataset_id/as_of/note/profiles fields exactly per plan.","acceptance_criteria":"- tool_versions contains upstream tools plus lock.\n- profiles defaults to [] in v0.\n- Optional metadata fields are explicit null when omitted.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-24T23:24:53.475842Z","created_by":"zac","updated_at":"2026-02-24T23:48:54.678460Z","closed_at":"2026-02-24T23:48:54.668816Z","close_reason":"Implemented metadata hydration and tool_versions accumulation with tests and full gate pass","source_repo":".","compaction_level":0,"original_size":0,"labels":["lock","metadata","provenance"],"dependencies":[{"issue_id":"bd-3un","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":54,"issue_id":"bd-3un","author":"MagentaLake","text":"Start update: implementing tool_versions merge and metadata hydration in lockfile assembly path with deterministic behavior/tests.","created_at":"2026-02-24T23:47:52Z"},{"id":55,"issue_id":"bd-3un","author":"FrostyHollow","text":"Starting bd-3un now after bd-8em pause. Scope: tool_versions accumulation across records (including skipped), metadata hydration fields, and profiles default behavior with deterministic tests.","created_at":"2026-02-24T23:47:58Z"},{"id":56,"issue_id":"bd-3un","author":"FrostyHollow","text":"Temporarily pausing: active exclusive reservation conflict on src/lockfile/mod.rs (held by MagentaLake). Switching immediately to an unblocked ready bead.","created_at":"2026-02-24T23:48:15Z"},{"id":57,"issue_id":"bd-3un","author":"MagentaLake","text":"Finish update: added metadata hydration and tool_versions merge helpers in src/lockfile/mod.rs; includes skipped-record tool_versions, first-seen conflict behavior, lock-version insertion, nullable metadata fields, and profiles default []. Added deterministic tests. Validation passed: cargo fmt --check; cargo check --all-targets; cargo clippy --all-targets -- -D warnings; cargo test.","created_at":"2026-02-24T23:48:54Z"}]}
{"id":"bd-3w1","title":"Implement CLI contract and argument parsing (main + witness subcommands)","description":"Implement CLI parsing for compare mode and witness subcommands.\n\nThis includes positional input selection and all declared flags.","design":"- Define clap structs for `lock [input]` plus flags: dataset_id, as_of, note, no_witness, describe, schema, version.\n- Add witness subcommands: query, last, count with filter flags and --json switches.\n- Ensure `--describe`/`--schema` short-circuit before input validation.","acceptance_criteria":"- CLI accepts all plan-declared options/subcommands.\n- Parse-level errors return exit 2 semantics.\n- Help/usage text is coherent and non-ambiguous.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:52.764086Z","created_by":"zac","updated_at":"2026-02-24T23:46:09.969851Z","closed_at":"2026-02-24T23:46:09.969747Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","foundation","lock"],"dependencies":[{"issue_id":"bd-3w1","depends_on_id":"bd-12h","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3w1","depends_on_id":"bd-36t","type":"related","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-7ot","title":"E2E spine compatibility fixtures for vacuum|hash|fingerprint -> lock","description":"Build end-to-end compatibility fixtures for the spine path: vacuum | hash | fingerprint | lock.\n\nThese fixtures verify lock integrates cleanly with upstream record formats.","design":"- Add representative fixture streams for hash-only and fingerprinted records.\n- Assert lock output members/skipped/tool_versions against fixtures.\n- Include at least one degraded `_skipped` upstream case.","acceptance_criteria":"- E2E fixture tests demonstrate spine compatibility and partial-lock behavior.\n- Fixture data is deterministic and documented.\n- Regression test fails if upstream compatibility assumptions break.","notes":"DONE: 13 E2E spine compatibility tests in tests/e2e_spine.rs. Fixtures: vacuum-only refuses (missing hash), hash.v0 pipeline LOCK_CREATED, full 3-tool pipeline (vacuum→hash→fingerprint) with matched/unmatched fingerprints, mixed pipeline with skipped records (LOCK_PARTIAL), mixed record versions from different pipeline stages, large dataset (50 records) determinism, extra upstream fields silently ignored, relative_path preferred over path, Windows path normalization, warning detail with numeric values, all-skipped scenario, single-file pipeline. All self-hash verified. fmt+clippy clean.","status":"closed","priority":2,"issue_type":"task","assignee":"SunnyLynx","created_at":"2026-02-24T23:25:33.427767Z","created_by":"zac","updated_at":"2026-02-25T00:05:34.995591Z","closed_at":"2026-02-25T00:05:34.995426Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","lock","spine","tests"],"dependencies":[{"issue_id":"bd-7ot","depends_on_id":"bd-1ab","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-7ot","depends_on_id":"bd-1jj","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-8em","title":"Implement self-hash (lock_hash) compute and verifier helper","description":"Implement lock self-hash computation and verification helper.\n\nlock_hash is a core integrity guarantee and must follow PLAN byte-for-byte semantics.","design":"- Build lock object with lock_hash=\"\" for pre-hash canonicalization.\n- SHA256 canonical bytes and inject `sha256:<hex>` into final output.\n- Add verification helper path for tests and downstream tooling.","acceptance_criteria":"- Recomputed hash matches emitted lock_hash for valid artifacts.\n- Any payload mutation causes verification failure.\n- Hash helper is deterministic and isolated from wall-clock variance.","notes":"Definition of Done:\n- Implementation matches docs/PLAN.md for this scope.\n- Tests added/updated for the changed behavior.\n- `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, and `cargo test` pass locally.\n- Bead updated with concise implementation notes and any follow-up risks.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-24T23:24:53.774334Z","created_by":"zac","updated_at":"2026-02-24T23:48:27.777270Z","closed_at":"2026-02-24T23:48:27.777159Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["hashing","integrity","lock"],"dependencies":[{"issue_id":"bd-8em","depends_on_id":"bd-2kh","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":58,"issue_id":"bd-8em","author":"FrostyHollow","text":"Starting bd-8em now. Scope: lock_hash compute + verify helper using canonical pre-hash serialization semantics, with deterministic tests and mutation-failure checks.","created_at":"2026-02-24T23:47:16Z"},{"id":59,"issue_id":"bd-8em","author":"MagentaLake","text":"Start update: implementing lock_hash compute/verify helper paths in src/lockfile/self_hash.rs with deterministic tests.","created_at":"2026-02-24T23:47:35Z"},{"id":60,"issue_id":"bd-8em","author":"FrostyHollow","text":"Temporarily pausing: blocked by active exclusive reservation conflict on src/lockfile/self_hash.rs (held by ChartreuseForest). Switching immediately to another ready bead per routing.","created_at":"2026-02-24T23:47:37Z"}]}
{"id":"bd-dj6","title":"Release parity: automate Homebrew tap updates for lock","description":"Add a post-release automation step that updates cmdrvl/homebrew-tap for lock artifacts.\n\nDesign:\n- Download release SHA256SUMS for the lock version.\n- Generate/update lock formula with platform-specific URLs + checksums.\n- Commit and push formula updates to tap repo using release automation token.\n\nAcceptance criteria:\n- Homebrew formula update is automated in release pipeline.\n- Formula checksums match published release artifacts.\n- No-op behavior when formula content is unchanged.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T02:47:06.274905Z","created_by":"zac","updated_at":"2026-02-25T02:51:46.895273Z","closed_at":"2026-02-25T02:51:46.895171Z","close_reason":"Homebrew tap automation added to release workflow:\n1. Downloads SHA256SUMS from GitHub release\n2. Generates platform-specific formula (macos arm/intel, linux x86_64/aarch64)\n3. Pushes to cmdrvl/homebrew-tap via HOMEBREW_TAP_TOKEN secret\n4. No-op when formula content unchanged (git diff --quiet)\n5. Graceful skip when TAP_TOKEN not configured\nYAML validated.","source_repo":".","compaction_level":0,"original_size":0,"labels":["distribution","homebrew","lock","release"],"dependencies":[{"issue_id":"bd-dj6","depends_on_id":"bd-1cj","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-dj6","depends_on_id":"bd-3c5","type":"parent-child","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-v08","title":"Unit tests: parsing, version-gate, missing-hash, skipped handling","description":"Add unit coverage for parsing and validation primitives.\n\nThese tests must lock in refusal behavior before orchestration-level tests.","design":"- Unit-test parse failures, version gate failures, and missing-hash refusal conditions.\n- Test skipped-record routing and partial classification edge-cases.\n- Add fixtures for unknown versions and malformed lines.","acceptance_criteria":"- Unit tests fail on regressions for E_BAD_INPUT and E_MISSING_HASH handling.\n- Skipped/non-skipped behavior is explicitly covered.\n- Test names clearly map to plan clauses.","notes":"DONE: 33 integration tests in tests/unit_parsing.rs covering parse→validate→classify pipeline, version gate (all known versions, future, empty, numeric, first-bad-stops), missing hash (detection, path fallback, unknown path, cap at 5, empty/whitespace hash), skipped handling (_skipped:true/false/missing, warnings passthrough, empty/missing warnings), fingerprint passthrough (matched, not-matched, absent, null), classification edge cases (missing path, missing size, sort order, backslash normalization, Unicode), metadata hydration (merge, first-seen-wins, no-tool-versions), JSONL parsing edges. Also fixed Rust 2024 unsafe env::set_var compilation error in witness/mod.rs. Total: 118 tests pass, fmt+clippy clean.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T23:25:32.089076Z","created_by":"zac","updated_at":"2026-02-24T23:57:05.765598Z","closed_at":"2026-02-24T23:57:05.765487Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["input","lock","tests","unit"],"dependencies":[{"issue_id":"bd-v08","depends_on_id":"bd-2oz","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-v08","depends_on_id":"bd-3c0","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-v08","depends_on_id":"bd-3dl","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-v08","depends_on_id":"bd-3nw","type":"blocks","created_at":"2026-02-25T03:07:40Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-vht","title":"LOCK VERIFY epic: lockfile verification subcommand","description":"Implement lock verify — two-level lockfile verification (self-hash integrity + optional member content verification against disk). Spec: docs/PLAN.md verify section. Bridges Prove → Outcomes surface.\n\n## Success Criteria\n- `lock verify dec.lock.json` returns exit 0 for untampered lockfile (Level 1)\n- `lock verify dec.lock.json --root /data/dec` returns exit 0 when all members match (Level 2)\n- Tampered lockfile returns exit 1 with VERIFY_FAILED\n- Missing/drifted member files return exit 1 with failure details\n- Malformed lockfile returns exit 2 with refusal envelope\n- Human-readable (default) and --json output modes both work\n- Witness records include params.subcommand='verify'\n- All existing lock tests continue to pass (no regressions)\n- cargo fmt --check && cargo clippy --all-targets -- -D warnings && cargo test passes","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-25T03:08:13.717084Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:47:42.257573Z","closed_at":"2026-02-25T03:47:42.257537Z","close_reason":"All 8 child beads closed. lock verify fully implemented: CLI parsing (bd-vht.1), validation/refusals (bd-vht.2), Level 1 self-hash orchestration (bd-vht.3), Level 2 member verification (bd-vht.4), human-readable output (bd-vht.5), generalized witness (bd-vht.6), 15 E2E tests (bd-vht.7), operator.json + schema sync (bd-vht.8). Total: 280 tests pass, quality gate clean (fmt + clippy + test).","source_repo":".","compaction_level":0,"original_size":0,"labels":["epic","lock","spine","verify"]}
{"id":"bd-vht.1","title":"Add Verify variant to CLI Command enum and argument parsing","description":"Add Verify(VerifyArgs) to the Command enum in src/cli/mod.rs. VerifyArgs: lockfile (positional PathBuf), --root (Option<PathBuf>), --json (bool), --no-witness (bool), --strict (bool). Add dispatch_verify() in cli::run() — dispatch before witness subcommands. Confirm existing positional input arg still works (lock foo.jsonl should not break). Add clap parse tests for verify subcommand.\n\n## Acceptance Criteria\n- `lock verify dec.lock.json` parses correctly with lockfile as positional arg\n- `lock verify dec.lock.json --root /data --json --strict --no-witness` parses all flags\n- `lock foo.jsonl` still works as positional input for lock creation (no regression)\n- `lock verify` with no lockfile arg returns exit 2 (clap error)\n- Parse tests cover: all flags, missing required arg, unknown flags rejected\n- cli::run() dispatches to verify handler before witness subcommands","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-25T03:08:22.828947Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:34:30.520951Z","closed_at":"2026-02-25T03:34:30.520916Z","close_reason":"Verify(VerifyArgs) added to Command enum, VerifyArgs struct with all 5 fields, dispatch_verify in cli::run(), 4 parse tests. All existing tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","verify"],"dependencies":[{"issue_id":"bd-vht.1","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:08:22.828947Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.2","title":"Implement verify lockfile validation and refusal codes","description":"Create src/verify/mod.rs with lockfile validation logic. Define VerifyRefusalCode enum: E_IO, E_BAD_LOCKFILE, E_UNSUPPORTED_VERSION, E_ROOT_NOT_FOUND, E_UNKNOWN_ALGORITHM. Make sort_value() in src/refusal/mod.rs pub so verify can reuse it for canonical key ordering. Build refusal envelopes with version 'lock-verify.v0', reusing RefusalEnvelope struct from src/refusal/mod.rs with verify-specific constructors that set version='lock-verify.v0'. Validation checks: file readable, valid JSON, has version/lock_hash/members fields, no absolute member paths, no '..' traversal, recognized algorithm prefixes (sha256, blake3). Each refusal includes code, message, detail, and next_command.\n\n## Acceptance Criteria\n- VerifyRefusalCode enum has all 5 codes with correct as_str() wire format\n- sort_value() in src/refusal/mod.rs changed from fn to pub fn\n- Unreadable file → E_IO with path and OS error in detail\n- Malformed JSON → E_BAD_LOCKFILE with parse error\n- Missing version/lock_hash/members → E_BAD_LOCKFILE with missing_fields list\n- Absolute member path → E_BAD_LOCKFILE with member_index and member_path\n- Path traversal (..) → E_BAD_LOCKFILE with member_index and member_path\n- Unknown version → E_UNSUPPORTED_VERSION with version string\n- Unknown algorithm prefix → E_UNKNOWN_ALGORITHM with member_path and algorithm\n- All refusal envelopes have sorted keys (canonical JSON via pub sort_value())\n- Refusal version is 'lock-verify.v0' not 'lock.v0'\n- Module-level unit tests for each refusal code path and envelope shape","acceptance_criteria":"VerifyRefusalCode enum has all 5 codes with correct as_str() wire format\nsort_value() in src/refusal/mod.rs changed from fn to pub fn\nUnreadable file → E_IO with path and OS error in detail\nMalformed JSON → E_BAD_LOCKFILE with parse error\nMissing version/lock_hash/members → E_BAD_LOCKFILE with missing_fields list\nAbsolute member path → E_BAD_LOCKFILE with member_index and member_path\nPath traversal (..) → E_BAD_LOCKFILE with member_index and member_path\nUnknown version → E_UNSUPPORTED_VERSION with version string\nUnknown algorithm prefix → E_UNKNOWN_ALGORITHM with member_path and algorithm\nAll refusal envelopes have sorted keys (canonical JSON via pub sort_value())\nRefusal version is 'lock-verify.v0' not 'lock.v0'\nModule-level unit tests for each refusal code path and envelope shape","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-25T03:08:32.421484Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:34:30.594181Z","closed_at":"2026-02-25T03:34:30.594144Z","close_reason":"src/verify/mod.rs created with VerifyRefusalCode enum (5 codes), 8 refusal constructors, validate_lockfile_json() with all checks, sort_value() made pub in refusal/mod.rs. 22 unit tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["refusal","verify"],"dependencies":[{"issue_id":"bd-vht.2","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:08:32.421484Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.3","title":"Implement Level 1 self-hash verification orchestration","description":"Wire up verify orchestration in src/verify/mod.rs: pub fn run_verify(args: VerifyArgs) -> u8. Read lockfile from disk, run validation (from bd-vht.2), then call Level 1 verification.\n\nLevel 1 detail: verify_lock_hash_from_json() only returns bool — it doesn't expose stored/computed hashes. Add a companion function verify_lock_hash_detail(json: &str) -> Result<LockHashDetail, _> in src/lockfile/self_hash.rs that returns { stored, computed, valid }. The existing verify_lock_hash_from_json() can delegate to it. This preserves invariant #7 (verify doesn't implement its own serialization/hashing.\n\nBuild VerifyResult with LockHashResult (stored, computed, valid). Emit JSON output to stdout (VerifyResult serialized with sorted keys). When self-hash fails: outcome=VERIFY_FAILED, members=null, skip Level 2. When self-hash passes and no --root: outcome=VERIFY_OK, members=null. Append witness record via generalized interface (from bd-vht.6). Return appropriate exit code (0/1/2).\n\nThis bead delivers a working lock verify for Level 1 with JSON output only. Human-readable output is added by bd-vht.5.\n\n## Acceptance Criteria\n- verify_lock_hash_detail() added to src/lockfile/self_hash.rs returning { stored, computed, valid }\n- existing verify_lock_hash_from_json() delegates to verify_lock_hash_detail()\n- run_verify() reads lockfile, validates, and calls verify_lock_hash_detail()\n- Valid lockfile without --root → exit 0, outcome VERIFY_OK, members null\n- Tampered lockfile → exit 1, outcome VERIFY_FAILED, lock_hash.valid=false, members null\n- Validation failure → exit 2, refusal envelope emitted to stdout\n- JSON output emitted to stdout with sorted keys (lock-verify.v0 schema)\n- VerifyResult struct has version, outcome, lockfile, lock_hash, members, tool_versions\n- LockHashResult has stored, computed, valid fields\n- Witness record appended with params.subcommand='verify' (uses generalized API from bd-vht.6)\n- Exit codes: 0 (VERIFY_OK), 1 (VERIFY_FAILED), 2 (REFUSAL)\n- Module-level unit tests: round-trip verify, tamper detection, refusal routing, verify_lock_hash_detail parity with verify_lock_hash_from_json\nEOF\n)","acceptance_criteria":"verify_lock_hash_detail() added to src/lockfile/self_hash.rs returning { stored, computed, valid }\nexisting verify_lock_hash_from_json() delegates to verify_lock_hash_detail()\nrun_verify() reads lockfile, validates, and calls verify_lock_hash_detail()\nValid lockfile without --root → exit 0, outcome VERIFY_OK, members null\nTampered lockfile → exit 1, outcome VERIFY_FAILED, lock_hash.valid=false, members null\nValidation failure → exit 2, refusal envelope emitted to stdout\nJSON output emitted to stdout with sorted keys (lock-verify.v0 schema)\nVerifyResult struct has version, outcome, lockfile, lock_hash, members, tool_versions\nLockHashResult has stored, computed, valid fields\nWitness record appended with params.subcommand='verify' (uses generalized API from bd-vht.6)\nExit codes: 0 (VERIFY_OK), 1 (VERIFY_FAILED), 2 (REFUSAL)\nModule-level unit tests: round-trip verify, tamper detection, refusal routing, verify_lock_hash_detail parity with verify_lock_hash_from_json","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-25T03:08:42.041710Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:36:28.938783Z","closed_at":"2026-02-25T03:36:28.938747Z","close_reason":"Level 1 verify orchestration complete. verify_lock_hash_detail() added to self_hash.rs, run_verify() reads/validates/verifies lockfile, emits JSON output with sorted keys, records witness. 6 orchestration tests + all existing tests pass (249 total).","source_repo":".","compaction_level":0,"original_size":0,"labels":["self-hash","verify"],"dependencies":[{"issue_id":"bd-vht.3","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:08:42.041710Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.3","depends_on_id":"bd-vht.1","type":"blocks","created_at":"2026-02-25T03:10:10.029707Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.3","depends_on_id":"bd-vht.2","type":"blocks","created_at":"2026-02-25T03:10:10.090065Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.3","depends_on_id":"bd-vht.6","type":"blocks","created_at":"2026-02-25T03:16:03.575192Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.4","title":"Implement Level 2 member filesystem verification","description":"Create src/verify/members.rs. For each member in the lockfile: resolve path against --root, check existence (MISSING), stat size (SIZE_MISMATCH), stream-read and hash using algorithm prefix from stored bytes_hash (sha256 via sha2 crate, blake3 via blake3 crate). IO errors become skips (IO_ERROR) not failures. Build MembersResult with checked/verified/failed/skipped counts and failure/skip detail arrays. Outcome logic: all verified=VERIFY_OK, any failed=VERIFY_FAILED, no failed + some skipped=VERIFY_PARTIAL (or VERIFY_FAILED if --strict).\n\n## Acceptance Criteria\n- Each member resolved as <root>/<member.path>\n- Missing file → MemberFailure with reason MISSING, actual fields null\n- Size mismatch → MemberFailure with reason SIZE_MISMATCH (hash skipped)\n- Hash mismatch → MemberFailure with reason HASH_MISMATCH, actual hash included\n- IO error during read → MemberSkip with reason IO_ERROR and OS error detail\n- sha256: prefix → uses SHA256; blake3: prefix → uses BLAKE3\n- Streaming hash (not loading full file into memory)\n- MembersResult counts are consistent: checked = verified + failed + skipped\n- --strict promotes VERIFY_PARTIAL (skips but no failures) to VERIFY_FAILED\n- All members pass → VERIFY_OK\n- Module-level unit tests: each failure reason, each skip reason, count consistency, strict promotion","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-25T03:08:51.169181Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:39:05.560608Z","closed_at":"2026-02-25T03:39:05.560571Z","close_reason":"src/verify/members.rs: verify_members() streams files with sha256/blake3, checks existence/size/hash, returns MembersResult with counts and failure/skip detail. members_outcome() with --strict support. Wired into orchestration. 10 unit tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["members","verify"],"dependencies":[{"issue_id":"bd-vht.4","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:08:51.169181Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.4","depends_on_id":"bd-vht.3","type":"blocks","created_at":"2026-02-25T03:10:10.152438Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.5","title":"Implement human-readable output mode for verify","description":"Add human-readable output rendering to src/verify/output.rs. JSON output is already handled by bd-vht.3. This bead adds the default (no --json) mode: concise single-line summary with Unicode markers, followed by indented failure/skip details. Handle all four outcomes: VERIFY_OK (checkmark), VERIFY_FAILED (cross), VERIFY_PARTIAL (warning), REFUSAL (code and message). Wire the --json flag to choose between modes in the orchestration.\n\n## Acceptance Criteria\n- Default output (no --json) emits human-readable text to stdout\n- VERIFY_OK (self-hash only): single line with checkmark, hash prefix\n- VERIFY_OK (with --root): checkmark, hash prefix, N/N members verified\n- VERIFY_FAILED (tampered): cross, stored vs computed hash on separate lines\n- VERIFY_FAILED (drift): cross, member count summary, then per-failure lines (reason, path)\n- VERIFY_PARTIAL: warning marker, verified/skipped counts, per-skip lines (reason, path, detail)\n- REFUSAL: cross, code and message\n- --json flag still works (delegates to existing JSON rendering from bd-vht.3)\n- Module-level unit tests for each human output variant","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-25T03:09:00.223018Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:39:05.634322Z","closed_at":"2026-02-25T03:39:05.634285Z","close_reason":"src/verify/output.rs: render_human() with Unicode markers for all 4 outcomes (OK, FAILED/tampered, FAILED/drift, PARTIAL, REFUSAL). --json flag routing in orchestration. 6 unit tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["output","verify"],"dependencies":[{"issue_id":"bd-vht.5","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:09:00.223018Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.5","depends_on_id":"bd-vht.3","type":"blocks","created_at":"2026-02-25T03:10:10.213763Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.6","title":"Generalize witness append for verify params and wire up verify witness","description":"Refactor witness::append_witness_record to accept outcome as &str, exit_code as u8, and params as serde_json::Value instead of the lock-creation-specific DomainOutcome enum and WitnessParams struct.\n\nCurrent signature: fn append_witness_record(outcome: DomainOutcome, output_bytes: &[u8], params: &WitnessParams)\nNew signature: fn append_witness_record(outcome: &str, exit_code: u8, output_bytes: &[u8], params: serde_json::Value)\n\nThe exit_code parameter is needed because DomainOutcome.exit_code() is no longer available when outcome is a string.\n\nLock creation builds its params JSON (dataset_id, as_of, note) before calling — must produce byte-identical records to the old code. Verify builds its params JSON (subcommand: 'verify', root, strict) before calling. The shared append function handles id computation, output_hash, prev chaining, and ledger append identically. Update existing lock creation call site in lib.rs to use the new interface. Existing witness tests must continue to pass.\n\n## Acceptance Criteria\n- append_witness_record accepts outcome as &str, exit_code as u8, and params as serde_json::Value\n- Existing lock creation witness records are byte-identical before and after refactor\n- All existing witness tests pass without modification (regression check)\n- Lock creation call site in lib.rs updated to build params JSON and pass outcome string + exit code\n- New function signature supports arbitrary params for future subcommands\n- Module-level unit tests: lock-creation params roundtrip, verify params roundtrip, exit_code correctly recorded","acceptance_criteria":"append_witness_record accepts outcome as &str, exit_code as u8, and params as serde_json::Value\nExisting lock creation witness records are byte-identical before and after refactor\nAll existing witness tests pass without modification (regression check)\nLock creation call site in lib.rs updated to build params JSON and pass outcome string + exit code\nNew function signature supports arbitrary params for future subcommands\nModule-level unit tests: lock-creation params roundtrip, verify params roundtrip, exit_code correctly recorded","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-25T03:09:09.980917Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:34:30.667143Z","closed_at":"2026-02-25T03:34:30.667106Z","close_reason":"append_witness_record now accepts outcome: &str, exit_code: u8, params: Value, inputs: Value. Call site in lib.rs updated. All existing witness tests pass, verify params roundtrip test added.","source_repo":".","compaction_level":0,"original_size":0,"labels":["verify","witness"],"dependencies":[{"issue_id":"bd-vht.6","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:09:09.980917Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.7","title":"Verify integration and E2E tests","description":"Integration and E2E tests that exercise lock verify end-to-end via the compiled binary or full orchestration path. Unit tests live in their respective implementation beads (.2, .3, .4, .5, .6). This bead covers cross-module scenarios that can only be tested with the full pipeline.\n\n## Acceptance Criteria\n- E2E: create lockfile via `lock`, then `lock verify` → exit 0, VERIFY_OK\n- E2E: create lockfile, verify with --root against real files → exit 0, all members verified\n- E2E: create lockfile, modify a source file, verify → exit 1, HASH_MISMATCH\n- E2E: create lockfile, delete a source file, verify → exit 1, MISSING\n- E2E: create lockfile, tamper lockfile JSON, verify → exit 1, lock_hash.valid=false, members null\n- E2E: verify with --root /nonexistent → exit 2, E_ROOT_NOT_FOUND\n- E2E: verify with --strict and I/O error → exit 1, VERIFY_FAILED (not PARTIAL)\n- E2E: --json output parses as valid JSON; default output has Unicode markers\n- E2E: witness record appended with subcommand=verify after verify run\n- E2E: --no-witness suppresses witness append\n- All existing lock tests pass (cargo test, no regressions)\n- Quality gate: cargo fmt --check && cargo clippy --all-targets -- -D warnings","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T03:09:21.534319Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:45:12.228112Z","closed_at":"2026-02-25T03:45:12.228076Z","close_reason":"15 E2E tests added in tests/verify_e2e.rs covering: Level 1 self-hash (exit 0), Level 2 member verification (exit 0), modified file HASH_MISMATCH (exit 1), deleted file MISSING (exit 1), tampered lockfile with members null (exit 1), root not found (exit 2), malformed lockfile (exit 2), missing lockfile (exit 2), --strict promotes PARTIAL to FAILED, --json valid JSON, human-readable Unicode markers, witness append with subcommand=verify, --no-witness suppresses append, regression test for lock creation. All 280 tests pass, quality gate clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["test","verify"],"dependencies":[{"issue_id":"bd-vht.7","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:09:21.534319Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.7","depends_on_id":"bd-vht.4","type":"blocks","created_at":"2026-02-25T03:10:10.333997Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.7","depends_on_id":"bd-vht.5","type":"blocks","created_at":"2026-02-25T03:10:10.394592Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.7","depends_on_id":"bd-vht.6","type":"blocks","created_at":"2026-02-25T03:10:10.455023Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
{"id":"bd-vht.8","title":"Update operator.json verify entry with arguments and options arrays","description":"The verify subcommand was added to operator.json during spec work. After implementation, validate the operator.json verify entry matches the actual CLI. Ensure the embedded operator.json (compiled via include_str!) passes the existing operator_json_is_valid_json test and that the verify subcommand entry matches implementation.\n\nAdd lock-verify-v0.schema.json to schemas/ as a reference document (not served via --schema — the existing lock --schema serves lock-v0.schema.json only; verify schema is documentation, not a runtime flag).\n\n## Acceptance Criteria\n- operator.json verify entry matches implemented CLI (args, flags, exit codes, refusals)\n- operator_json_is_valid_json test passes with updated operator.json\n- lock-verify-v0.schema.json added to schemas/ as reference document (not served at runtime)\n- lock --describe includes verify subcommand in output\n- No contradictions between operator.json and PLAN.md verify spec","acceptance_criteria":"operator.json verify entry matches implemented CLI (args, flags, exit codes, refusals)\noperator_json_is_valid_json test passes with updated operator.json\nlock-verify-v0.schema.json added to schemas/ as reference document (not served at runtime)\nlock --describe includes verify subcommand in output\nNo contradictions between operator.json and PLAN.md verify spec","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T03:09:30.554326Z","created_by":"zacharyruiz","updated_at":"2026-02-25T03:47:19.242399Z","closed_at":"2026-02-25T03:47:19.242356Z","close_reason":"operator.json verify entry matches implementation (args, flags, exit codes, refusals all align with CLI and PLAN.md spec). Added verify usage line to invocation.usage array. Created lock-verify-v0.schema.json in schemas/ as reference document. lock --describe includes verify subcommand. operator_json_is_valid_json test passes. All 280 tests pass, quality gate clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","verify"],"dependencies":[{"issue_id":"bd-vht.8","depends_on_id":"bd-vht","type":"parent-child","created_at":"2026-02-25T03:09:30.554326Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""},{"issue_id":"bd-vht.8","depends_on_id":"bd-vht.7","type":"blocks","created_at":"2026-02-25T03:10:10.514694Z","created_by":"zacharyruiz","metadata":"{}","thread_id":""}]}
